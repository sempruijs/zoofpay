var nf=Object.defineProperty;var Yi=t=>{throw TypeError(t)};var rf=(t,e,n)=>e in t?nf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>rf(t,typeof e!="symbol"?e+"":e,n),zi=(t,e,n)=>e.has(t)||Yi("Cannot "+n);var Qi=(t,e,n)=>(zi(t,e,"read from private field"),n?n.call(t):e.get(t)),Xi=(t,e,n)=>e.has(t)?Yi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Zi=(t,e,n,r)=>(zi(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);import{t as sf,a as of}from"../chunks/D-td1BSZ.js";import{J as cf,ab as af,u as uf,V as lf,K as ff,Y as Hr,W as Cn,X as Fn}from"../chunks/F6yd9h3J.js";import{e as hf,s as to}from"../chunks/CKKj7KCf.js";const df=t=>typeof t=="function",l=function(t,e){if(typeof t=="function")return function(){return t(arguments)?e.apply(this,arguments):n=>e(n,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(n,r){return arguments.length>=2?e(n,r):function(s){return e(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?e(n,r,s):function(i){return e(i,n,r)}};case 4:return function(n,r,s,i){return arguments.length>=4?e(n,r,s,i):function(o){return e(o,n,r,s)}};case 5:return function(n,r,s,i,o){return arguments.length>=5?e(n,r,s,i,o):function(c){return e(c,n,r,s,i)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const n=arguments;return function(r){return e(r,...n)}}}},B=t=>t,yr=t=>()=>t,eo=yr(!0),is=yr(!1),Gc=yr(void 0),gf=Gc;function h(t,e,n,r,s,i,o,c,u){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return s(r(n(e(t))));case 6:return i(s(r(n(e(t)))));case 7:return o(i(s(r(n(e(t))))));case 8:return c(o(i(s(r(n(e(t)))))));case 9:return u(c(o(i(s(r(n(e(t))))))));default:{let f=arguments[0];for(let d=1;d<arguments.length;d++)f=arguments[d](f);return f}}}const Vs=t=>(e,n)=>e===n||t(e,n),pf=l(2,(t,e)=>Vs((n,r)=>t(e(n),e(r)))),mf=t=>Vs((e,n)=>{if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0});let _f="3.14.1";const Sr=()=>_f,Tn=`effect/GlobalValue/globalStoreId/${Sr()}`;let Ue;const C=(t,e)=>(Ue||(globalThis[Tn]??(globalThis[Tn]=new Map),Ue=globalThis[Tn]),Ue.has(t)||Ue.set(t,e()),Ue.get(t)),bf=t=>typeof t=="string",os=t=>typeof t=="number",yf=t=>typeof t=="bigint",kr=df,Sf=t=>typeof t=="object"&&t!==null,vr=t=>Sf(t)||kr(t),E=l(2,(t,e)=>vr(t)&&e in t),Wc=l(2,(t,e)=>E(t,"_tag")&&t._tag===e),re=t=>t==null,kf=t=>E(t,"then")&&kr(t.then),Ir=t=>`BUG: ${t} - please report an issue at https://github.com/Effect-TS/effect/issues`;let Yc=class zc{constructor(e){a(this,"self");a(this,"called",!1);this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new zc(this.self)}};const vf=335903614,If=4150755663,wf=1481765933,Of=1284865837,Ef=9007199254740992,$f=134217728;class Mf{constructor(e,n,r,s){a(this,"_state");return re(n)&&re(e)?(n=Math.random()*4294967295>>>0,e=0):re(n)&&(n=e,e=0),re(s)&&re(r)?(s=this._state?this._state[3]:If,r=this._state?this._state[2]:vf):re(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),no(this._state,this._state[0],this._state[1],e>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=e[3]|1}integer(e){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%e}number(){const e=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(e*$f+n)/Ef}_next(){const e=this._state[0]>>>0,n=this._state[1]>>>0;Rf(this._state,e,n,wf,Of),no(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=e>>>18,s=(n>>>18|e<<14)>>>0;r=(r^e)>>>0,s=(s^n)>>>0;const i=(s>>>27|r<<5)>>>0,o=e>>>27,c=(-o>>>0&31)>>>0;return(i>>>o|i<<c)>>>0}}function Rf(t,e,n,r,s){let i=(n>>>16)*(s&65535)>>>0,o=(n&65535)*(s>>>16)>>>0,c=(n&65535)*(s&65535)>>>0,u=(n>>>16)*(s>>>16)+((o>>>16)+(i>>>16))>>>0;o=o<<16>>>0,c=c+o>>>0,c>>>0<o>>>0&&(u=u+1>>>0),i=i<<16>>>0,c=c+i>>>0,c>>>0<i>>>0&&(u=u+1>>>0),u=u+Math.imul(n,r)>>>0,u=u+Math.imul(e,s)>>>0,t[0]=u,t[1]=c}function no(t,e,n,r,s){let i=e+r>>>0;const o=n+s>>>0;o>>>0<n>>>0&&(i=i+1|0),t[0]=i,t[1]=o}const cs=Symbol.for("effect/Utils/YieldWrap");var ln;class fn{constructor(e){Xi(this,ln);Zi(this,ln,e)}[cs](){return Qi(this,ln)}}ln=new WeakMap;function Cf(t){if(typeof t=="object"&&t!==null&&cs in t)return t[cs]();throw new Error(Ir("yieldWrapGet"))}const st=C("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),Ff=t=>{const e={[t](n){return n()}};return function(n){return e[t](n)}},z=Ff("effect_internal_function"),Gr=C(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),w=Symbol.for("effect/Hash"),b=t=>{if(st.enabled===!0)return 0;switch(typeof t){case"number":return Js(t);case"bigint":return x(t.toString(10));case"boolean":return x(String(t));case"symbol":return x(String(t));case"string":return x(t);case"undefined":return x("undefined");case"function":case"object":return t===null?x("null"):t instanceof Date?b(t.toISOString()):Tf(t)?t[w]():Ks(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},Ks=t=>(Gr.has(t)||Gr.set(t,Js(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),Gr.get(t)),$=t=>e=>e*53^t,wr=t=>t&3221225471|t>>>1&1073741824,Tf=t=>E(t,w),Js=t=>{if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)e^=t/=4294967295;return wr(e)},x=t=>{let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return wr(e)},Nf=(t,e)=>{let n=12289;for(let r=0;r<e.length;r++)n^=h(x(e[r]),$(b(t[e[r]])));return wr(n)},Qc=t=>Nf(t,Object.keys(t)),hn=t=>{let e=6151;for(let n=0;n<t.length;n++)e=h(e,$(b(t[n])));return wr(e)},A=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,w,{value(){return r},enumerable:!1}),r}}const t=arguments[0],e=arguments[1];return Object.defineProperty(t,w,{value(){return e},enumerable:!1}),e},v=Symbol.for("effect/Equal");function I(){return arguments.length===1?t=>Wn(t,arguments[0]):Wn(arguments[0],arguments[1])}function Wn(t,e){if(t===e)return!0;const n=typeof t;if(n!==typeof e)return!1;if(n==="object"||n==="function"){if(t!==null&&e!==null){if(Yn(t)&&Yn(e))return b(t)===b(e)&&t[v](e)?!0:st.enabled&&st.tester?st.tester(t,e):!1;if(t instanceof Date&&e instanceof Date)return t.toISOString()===e.toISOString()}if(st.enabled){if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every((r,s)=>Wn(r,e[s]));if(Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){const r=Object.keys(t),s=Object.keys(e);if(r.length===s.length){for(const i of r)if(!(i in e&&Wn(t[i],e[i])))return st.tester?st.tester(t,e):!1;return!0}}return st.tester?st.tester(t,e):!1}}return st.enabled&&st.tester?st.tester(t,e):!1}const Yn=t=>E(t,v),Hs=()=>I,P=Symbol.for("nodejs.util.inspect.custom"),U=t=>{try{if(E(t,"toJSON")&&kr(t.toJSON)&&t.toJSON.length===0)return t.toJSON();if(Array.isArray(t))return t.map(U)}catch{return{}}return Pf(t)},K=t=>JSON.stringify(t,null,2),le=(t,e=2)=>{if(typeof t=="string")return t;try{return typeof t=="object"?Xc(t,e):String(t)}catch{return String(t)}},Xc=(t,e)=>{let n=[];const r=JSON.stringify(t,(s,i)=>typeof i=="object"&&i!==null?n.includes(i)?void 0:n.push(i)&&(Ht.fiberRefs!==void 0&&Zc(i)?i[Gs](Ht.fiberRefs):i):i,e);return n=void 0,r},Gs=Symbol.for("effect/Inspectable/Redactable"),Zc=t=>typeof t=="object"&&t!==null&&Gs in t,Ht=C("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),Af=(t,e)=>{const n=Ht.fiberRefs;Ht.fiberRefs=t;try{return e()}finally{Ht.fiberRefs=n}},Pf=t=>Zc(t)&&Ht.fiberRefs!==void 0?t[Gs](Ht.fiberRefs):t,y=(t,e)=>{switch(e.length){case 0:return t;case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let n=t;for(let r=0,s=e.length;r<s;r++)n=e[r](n);return n}}},We="Async",Or="Commit",at="Failure",Wr="OnFailure",zn="OnSuccess",Qn="OnSuccessAndFailure",ut="Success",ta="Sync",xf="Tag",dn="UpdateRuntimeFlags",Xn="While",Ye="Iterator",ea="WithRuntime",qn="Yield",Ws="RevertFlags",jf=Symbol.for("effect/Effect"),Lf=Symbol.for("effect/Stream"),Df=Symbol.for("effect/Sink"),qf=Symbol.for("effect/Channel"),fe={_R:t=>t,_E:t=>t,_A:t=>t,_V:Sr()},Uf={_A:t=>t,_In:t=>t,_L:t=>t,_E:t=>t,_R:t=>t},Bf={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},gn={[jf]:fe,[Lf]:fe,[Df]:Uf,[qf]:Bf,[v](t){return this===t},[w](){return A(this,Ks(this))},[Symbol.iterator](){return new Yc(new fn(this))},pipe(){return y(this,arguments)}},Ys={[w](){return A(this,Qc(this))},[v](t){const e=Object.keys(this),n=Object.keys(t);if(e.length!==n.length)return!1;for(const r of e)if(!(r in t&&I(this[r],t[r])))return!1;return!0}},pn={...gn,_op:Or},Vf={...pn,...Ys},Kf=function(){function t(){}return t.prototype=pn,t}(),na=Symbol.for("effect/Option"),ra={...gn,[na]:{_A:t=>t},[P](){return this.toJSON()},toString(){return K(this.toJSON())}},Jf=Object.assign(Object.create(ra),{_tag:"Some",_op:"Some",[v](t){return sa(t)&&oa(t)&&I(this.value,t.value)},[w](){return A(this,$(b(this._tag))(b(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:U(this.value)}}}),Hf=b("None"),Gf=Object.assign(Object.create(ra),{_tag:"None",_op:"None",[v](t){return sa(t)&&ia(t)},[w](){return Hf},toJSON(){return{_id:"Option",_tag:this._tag}}}),sa=t=>E(t,na),ia=t=>t._tag==="None",oa=t=>t._tag==="Some",ca=Object.create(Gf),as=t=>{const e=Object.create(Jf);return e.value=t,e},aa=Symbol.for("effect/Either"),ua={...gn,[aa]:{_R:t=>t},[P](){return this.toJSON()},toString(){return K(this.toJSON())}},Wf=Object.assign(Object.create(ua),{_tag:"Right",_op:"Right",[v](t){return la(t)&&ha(t)&&I(this.right,t.right)},[w](){return $(b(this._tag))(b(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:U(this.right)}}}),Yf=Object.assign(Object.create(ua),{_tag:"Left",_op:"Left",[v](t){return la(t)&&fa(t)&&I(this.left,t.left)},[w](){return $(b(this._tag))(b(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:U(this.left)}}}),la=t=>E(t,aa),fa=t=>t._tag==="Left",ha=t=>t._tag==="Right",zf=t=>{const e=Object.create(Yf);return e.left=t,e},Qf=t=>{const e=Object.create(Wf);return e.right=t,e},Ct=Qf,he=zf,Ge=fa,Nn=ha,Xf=l(2,(t,{onLeft:e,onRight:n})=>Ge(t)?e(t.left):n(t.right)),Zf=Xf({onLeft:B,onRight:B}),da=t=>t.length>0,ga=t=>(e,n)=>e===n?0:t(e,n),th=ga((t,e)=>t<e?-1:1),eh=l(2,(t,e)=>ga((n,r)=>t(e(n),e(r)))),nh=t=>l(2,(e,n)=>t(e,n)===1),k=()=>ca,R=as,X=ia,kt=oa,zs=l(2,(t,{onNone:e,onSome:n})=>X(t)?e():n(t.value)),Yt=l(2,(t,e)=>X(t)?e():t.value),rh=l(2,(t,e)=>X(t)?R(e()):t),Qs=t=>t==null?k():R(t),qt=Yt(Gc),sh=l(2,(t,e)=>X(t)?k():R(e(t.value))),ih=l(2,(t,e)=>X(t)?k():e(t.value)),oh=t=>l(2,(e,n)=>X(e)?!1:t(e.value,n)),ch=Hs(),ah=oh(ch),uh=(...t)=>t,Xs=t=>new Array(t),lh=l(2,(t,e)=>{const n=Math.max(1,Math.floor(t)),r=new Array(n);for(let s=0;s<n;s++)r[s]=e(s);return r}),V=t=>Array.isArray(t)?t:Array.from(t),fh=t=>Array.isArray(t)?t:[t],Zn=l(2,(t,e)=>[e,...t]),hh=l(2,(t,e)=>[...t,e]),pa=l(2,(t,e)=>V(t).concat(V(e))),dh=t=>t.length===0,gh=dh,ph=da,et=da,ma=(t,e)=>t<0||t>=e.length,mh=(t,e)=>Math.floor(Math.min(Math.max(0,t),e.length)),_h=l(2,(t,e)=>{const n=Math.floor(e);return ma(n,t)?k():R(t[n])}),_a=l(2,(t,e)=>{const n=Math.floor(e);if(ma(n,t))throw new Error(`Index ${n} out of bounds`);return t[n]}),ze=_h(0),tt=_a(0),bh=t=>et(t)?R(ba(t)):k(),ba=t=>t[t.length-1],de=t=>t.slice(1),yh=(t,e)=>{let n=0;for(const r of t){if(!e(r,n))break;n++}return n},Sh=l(2,(t,e)=>wh(t,yh(t,e))),kh=l(2,(t,e)=>{const n=V(t);return n.slice(mh(e,n),n.length)}),ro=t=>Array.from(t).reverse(),tr=l(2,(t,e)=>{const n=Array.from(t);return n.sort(e),n}),so=l(2,(t,e)=>vh(t,e,uh)),vh=l(3,(t,e,n)=>{const r=V(t),s=V(e);if(et(r)&&et(s)){const i=[n(tt(r),tt(s))],o=Math.min(r.length,s.length);for(let c=1;c<o;c++)i[c]=n(r[c],s[c]);return i}return[]}),Ih=Hs(),wh=l(2,(t,e)=>{const n=Array.from(t),r=Math.floor(e);return et(n)?r>=1?Oh(n,r):[[],n]:[n,[]]}),Oh=l(2,(t,e)=>{const n=Math.max(1,Math.floor(e));return n>=t.length?[Eh(t),[]]:[Zn(t.slice(1,n),tt(t)),t.slice(n)]}),Eh=t=>t.slice(),$h=l(3,(t,e,n)=>{const r=V(t),s=V(e);return et(r)?et(s)?Sa(n)(pa(r,s)):r:s}),Un=l(2,(t,e)=>$h(t,e,Ih)),ge=()=>[],ft=t=>[t],oe=l(2,(t,e)=>t.map(e)),Mh=l(2,(t,e)=>{if(gh(t))return[];const n=[];for(let r=0;r<t.length;r++){const s=e(t[r],r);for(let i=0;i<s.length;i++)n.push(s[i])}return n}),Rh=Mh(B),ya=l(3,(t,e,n)=>V(t).reduce((r,s,i)=>n(r,s,i),e)),io=(t,e)=>{const n=[];let r=t,s;for(;kt(s=e(r));){const[i,o]=s.value;n.push(i),r=o}return n},Zs=mf,Sa=l(2,(t,e)=>{const n=V(t);if(et(n)){const r=[tt(n)],s=de(n);for(const i of s)r.every(o=>!e(i,o))&&r.push(i);return r}return[]}),Ch=t=>Sa(t,Hs()),Ce=l(2,(t,e)=>V(t).join(e)),Ze=th,Fh=t=>t.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),Th=Symbol.for("effect/Context/Tag"),er=Symbol.for("effect/Context/Reference"),Nh="effect/STM",Ah=Symbol.for(Nh),ka={...gn,_op:"Tag",[Ah]:fe,[Th]:{_Service:t=>t,_Identifier:t=>t},toString(){return K(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[P](){return this.toJSON()},of(t){return t},context(t){return Kh(this,t)}},Ph={...ka,[er]:er},xh=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;const r=Object.create(ka);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=t,r},jh=()=>(t,e)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,Ph),s.key=t,s.defaultValue=e.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},va=Symbol.for("effect/Context"),Lh={[va]:{_Services:t=>t},[v](t){if(qh(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!I(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[w](){return A(this,Js(this.unsafeMap.size))},pipe(){return y(this,arguments)},toString(){return K(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(U)}},[P](){return this.toJSON()}},pe=t=>{const e=Object.create(Lh);return e.unsafeMap=t,e},Dh=t=>{const e=new Error(`Service not found${t.key?`: ${String(t.key)}`:""}`);if(t.stack){const n=t.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(e.message=e.message+` (defined at ${r[1]})`)}}if(e.stack){const n=e.stack.split(`
`);n.splice(1,3),e.stack=n.join(`
`)}return e},qh=t=>E(t,va),Uh=t=>E(t,er),Bh=pe(new Map),Vh=()=>Bh,Kh=(t,e)=>pe(new Map([[t.key,e]])),Jh=l(3,(t,e,n)=>{const r=new Map(t.unsafeMap);return r.set(e.key,n),pe(r)}),Yr=C("effect/Context/defaultValueCache",()=>new Map),ti=t=>{if(Yr.has(t.key))return Yr.get(t.key);const e=t.defaultValue();return Yr.set(t.key,e),e},Hh=(t,e)=>t.unsafeMap.has(e.key)?t.unsafeMap.get(e.key):ti(e),Ia=l(2,(t,e)=>{if(!t.unsafeMap.has(e.key)){if(er in e)return ti(e);throw Dh(e)}return t.unsafeMap.get(e.key)}),Gh=Ia,Wh=l(2,(t,e)=>t.unsafeMap.has(e.key)?as(t.unsafeMap.get(e.key)):Uh(e)?as(ti(e)):ca),Yh=l(2,(t,e)=>{const n=new Map(t.unsafeMap);for(const[r,s]of e.unsafeMap)n.set(r,s);return pe(n)}),Fe=xh,ei=Vh,Be=Jh,wa=Gh,Oa=Ia,zh=Wh,Qh=Yh,Ea=jh,$a=Symbol.for("effect/Chunk");function Xh(t,e,n,r,s){for(let i=e;i<Math.min(t.length,e+s);i++)n[r+i-e]=t[i];return n}const Ma=[],Zh=t=>Vs((e,n)=>e.length===n.length&&Gt(e).every((r,s)=>t(r,ce(n,s)))),td=Zh(I),ed={[$a]:{_A:t=>t},toString(){return K(this.toJSON())},toJSON(){return{_id:"Chunk",values:Gt(this).map(U)}},[P](){return this.toJSON()},[v](t){return Ra(t)&&td(this,t)},[w](){return A(this,hn(Gt(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return Ma[Symbol.iterator]();default:return Gt(this)[Symbol.iterator]()}},pipe(){return y(this,arguments)}},L=t=>{const e=Object.create(ed);switch(e.backing=t,t._tag){case"IEmpty":{e.length=0,e.depth=0,e.left=e,e.right=e;break}case"IConcat":{e.length=t.left.length+t.right.length,e.depth=1+Math.max(t.left.depth,t.right.depth),e.left=t.left,e.right=t.right;break}case"IArray":{e.length=t.array.length,e.depth=0,e.left=St,e.right=St;break}case"ISingleton":{e.length=1,e.depth=0,e.left=St,e.right=St;break}case"ISlice":{e.length=t.length,e.depth=t.chunk.depth+1,e.left=St,e.right=St;break}}return e},Ra=t=>E(t,$a),St=L({_tag:"IEmpty"}),Nt=()=>St,zr=(...t)=>sd(t),nt=t=>L({_tag:"ISingleton",a:t}),Ca=t=>Ra(t)?t:Er(V(t)),us=(t,e,n)=>{switch(t.backing._tag){case"IArray":{Xh(t.backing.array,0,e,n,t.length);break}case"IConcat":{us(t.left,e,n),us(t.right,e,n+t.left.length);break}case"ISingleton":{e[n]=t.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<t.length;)e[s]=ce(t,r),r+=1,s+=1;break}}},nd=t=>{switch(t.backing._tag){case"IEmpty":return Ma;case"IArray":return t.backing.array;default:{const e=new Array(t.length);return us(t,e,0),t.backing={_tag:"IArray",array:e},t.left=St,t.right=St,t.depth=0,e}}},Gt=nd,rd=t=>{switch(t.backing._tag){case"IEmpty":case"ISingleton":return t;case"IArray":return L({_tag:"IArray",array:ro(t.backing.array)});case"IConcat":return L({_tag:"IConcat",left:me(t.backing.right),right:me(t.backing.left)});case"ISlice":return Er(ro(Gt(t)))}},me=rd,Er=t=>t.length===0?Nt():t.length===1?nt(t[0]):L({_tag:"IArray",array:t}),sd=t=>Er(t),ce=l(2,(t,e)=>{switch(t.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(e!==0)throw new Error("Index out of bounds");return t.backing.a}case"IArray":{if(e>=t.length||e<0)throw new Error("Index out of bounds");return t.backing.array[e]}case"IConcat":return e<t.left.length?ce(t.left,e):ce(t.right,e-t.left.length);case"ISlice":return ce(t.backing.chunk,e+t.backing.offset)}}),id=l(2,(t,e)=>ht(t,nt(e))),gt=l(2,(t,e)=>ht(nt(e),t)),ls=l(2,(t,e)=>{if(e<=0)return t;if(e>=t.length)return St;switch(t.backing._tag){case"ISlice":return L({_tag:"ISlice",chunk:t.backing.chunk,offset:t.backing.offset+e,length:t.backing.length-e});case"IConcat":return e>t.left.length?ls(t.right,e-t.left.length):L({_tag:"IConcat",left:ls(t.left,e),right:t.right});default:return L({_tag:"ISlice",chunk:t,offset:e,length:t.length-e})}}),ht=l(2,(t,e)=>{if(t.backing._tag==="IEmpty")return e;if(e.backing._tag==="IEmpty")return t;const n=e.depth-t.depth;if(Math.abs(n)<=1)return L({_tag:"IConcat",left:t,right:e});if(n<-1)if(t.left.depth>=t.right.depth){const r=ht(t.right,e);return L({_tag:"IConcat",left:t.left,right:r})}else{const r=ht(t.right.right,e);if(r.depth===t.depth-3){const s=L({_tag:"IConcat",left:t.right.left,right:r});return L({_tag:"IConcat",left:t.left,right:s})}else{const s=L({_tag:"IConcat",left:t.left,right:t.right.left});return L({_tag:"IConcat",left:s,right:r})}}else if(e.right.depth>=e.left.depth){const r=ht(t,e.left);return L({_tag:"IConcat",left:r,right:e.right})}else{const r=ht(t,e.left.left);if(r.depth===e.depth-3){const s=L({_tag:"IConcat",left:r,right:e.left.right});return L({_tag:"IConcat",left:s,right:e.right})}else{const s=L({_tag:"IConcat",left:e.left.right,right:e.right});return L({_tag:"IConcat",left:r,right:s})}}}),od=t=>t.length===0,_e=t=>t.length>0,Fa=t=>ce(t,0),be=Fa,Bt=t=>ls(t,1),fs=Symbol.for("effect/Duration"),Ta=BigInt(0),oo=BigInt(24),An=BigInt(60),hs=BigInt(1e3),co=BigInt(1e6),ao=BigInt(1e9),cd=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,vt=t=>{if(Na(t))return t;if(os(t))return ds(t);if(yf(t))return Qr(t);if(Array.isArray(t)&&t.length===2&&t.every(os))return t[0]===-1/0||t[1]===-1/0||Number.isNaN(t[0])||Number.isNaN(t[1])?Aa:t[0]===1/0||t[1]===1/0?fd:Qr(BigInt(Math.round(t[0]*1e9))+BigInt(Math.round(t[1])));if(bf(t)){const e=cd.exec(t);if(e){const[n,r,s]=e,i=Number(r);switch(s){case"nano":case"nanos":return Qr(BigInt(r));case"micro":case"micros":return hd(BigInt(r));case"milli":case"millis":return ds(i);case"second":case"seconds":return dd(i);case"minute":case"minutes":return gd(i);case"hour":case"hours":return pd(i);case"day":case"days":return md(i);case"week":case"weeks":return _d(i)}}}throw new Error("Invalid DurationInput")},uo={_tag:"Millis",millis:0},ad={_tag:"Infinity"},ud={[fs]:fs,[w](){return A(this,Qc(this.value))},[v](t){return Na(t)&&Id(this,t)},toString(){return`Duration(${Od(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:yd(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[P](){return this.toJSON()},pipe(){return y(this,arguments)}},wt=t=>{const e=Object.create(ud);return os(t)?isNaN(t)||t<=0?e.value=uo:Number.isFinite(t)?Number.isInteger(t)?e.value={_tag:"Millis",millis:t}:e.value={_tag:"Nanos",nanos:BigInt(Math.round(t*1e6))}:e.value=ad:t<=Ta?e.value=uo:e.value={_tag:"Nanos",nanos:t},e},Na=t=>E(t,fs),ld=t=>{switch(t.value._tag){case"Millis":return t.value.millis===0;case"Nanos":return t.value.nanos===Ta;case"Infinity":return!1}},Aa=wt(0),fd=wt(1/0),Qr=t=>wt(t),hd=t=>wt(t*hs),ds=t=>wt(t),dd=t=>wt(t*1e3),gd=t=>wt(t*6e4),pd=t=>wt(t*36e5),md=t=>wt(t*864e5),_d=t=>wt(t*6048e5),gs=t=>Sd(t,{onMillis:e=>e,onNanos:e=>Number(e)/1e6}),bd=t=>{const e=vt(t);switch(e.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return e.value.nanos;case"Millis":return BigInt(Math.round(e.value.millis*1e6))}},yd=t=>{const e=vt(t);switch(e.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(e.value.nanos/ao),Number(e.value.nanos%ao)];case"Millis":return[Math.floor(e.value.millis/1e3),Math.round(e.value.millis%1e3*1e6)]}},Sd=l(2,(t,e)=>{const n=vt(t);switch(n.value._tag){case"Nanos":return e.onNanos(n.value.nanos);case"Infinity":return e.onMillis(1/0);case"Millis":return e.onMillis(n.value.millis)}}),Pa=l(3,(t,e,n)=>{const r=vt(t),s=vt(e);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(gs(r),gs(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const i=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),o=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(i,o)}return n.onMillis(r.value.millis,s.value.millis)}),kd=(t,e)=>Pa(t,e,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),vd=l(2,(t,e)=>Pa(t,e,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),Id=l(2,(t,e)=>kd(vt(t),vt(e))),wd=t=>{const e=vt(t);if(e.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=bd(e),r=n/co,s=r/hs,i=s/An,o=i/An,c=o/oo;return{days:Number(c),hours:Number(o%oo),minutes:Number(i%An),seconds:Number(s%An),millis:Number(r%hs),nanos:Number(n%co)}},Od=t=>{const e=vt(t);if(e.value._tag==="Infinity")return"Infinity";if(ld(e))return"0";const n=wd(e),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},zt=5,ni=Math.pow(2,zt),Ed=ni-1,$d=ni/2,Md=ni/4;function Rd(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function ye(t,e){return e>>>t&Ed}function ie(t){return 1<<t}function xa(t,e){return Rd(t&e-1)}const Cd=(t,e)=>({value:t,previous:e});function ae(t,e,n,r){let s=r;if(!t){const i=r.length;s=new Array(i);for(let o=0;o<i;++o)s[o]=r[o]}return s[e]=n,s}function ja(t,e,n){const r=n.length-1;let s=0,i=0,o=n;if(t)s=i=e;else for(o=new Array(r);s<e;)o[i++]=n[s++];for(++s;s<=r;)o[i++]=n[s++];return t&&(o.length=r),o}function Fd(t,e,n,r){const s=r.length;if(t){let u=s;for(;u>=e;)r[u--]=r[u];return r[e]=n,r}let i=0,o=0;const c=new Array(s+1);for(;i<e;)c[o++]=r[i++];for(c[e]=n;i<s;)c[++o]=r[i++];return c}class xt{constructor(){a(this,"_tag","EmptyNode")}modify(e,n,r,s,i,o){const c=r(k());return X(c)?new xt:(++o.value,new Wt(e,s,i,c))}}function dt(t){return Wc(t,"EmptyNode")}function Td(t){return dt(t)||t._tag==="LeafNode"||t._tag==="CollisionNode"}function $r(t,e){return dt(t)?!1:e===t.edit}class Wt{constructor(e,n,r,s){a(this,"edit");a(this,"hash");a(this,"key");a(this,"value");a(this,"_tag","LeafNode");this.edit=e,this.hash=n,this.key=r,this.value=s}modify(e,n,r,s,i,o){if(I(i,this.key)){const u=r(this.value);return u===this.value?this:X(u)?(--o.value,new xt):$r(this,e)?(this.value=u,this):new Wt(e,s,i,u)}const c=r(k());return X(c)?this:(++o.value,La(e,n,this.hash,this,s,new Wt(e,s,i,c)))}}class ri{constructor(e,n,r){a(this,"edit");a(this,"hash");a(this,"children");a(this,"_tag","CollisionNode");this.edit=e,this.hash=n,this.children=r}modify(e,n,r,s,i,o){if(s===this.hash){const u=$r(this,e),f=this.updateCollisionList(u,e,this.hash,this.children,r,i,o);return f===this.children?this:f.length>1?new ri(e,this.hash,f):f[0]}const c=r(k());return X(c)?this:(++o.value,La(e,n,this.hash,this,s,new Wt(e,s,i,c)))}updateCollisionList(e,n,r,s,i,o,c){const u=s.length;for(let d=0;d<u;++d){const g=s[d];if("key"in g&&I(o,g.key)){const p=g.value,m=i(p);return m===p?s:X(m)?(--c.value,ja(e,d,s)):ae(e,d,new Wt(n,r,o,m),s)}}const f=i(k());return X(f)?s:(++c.value,ae(e,u,new Wt(n,r,o,f),s))}}class Se{constructor(e,n,r){a(this,"edit");a(this,"mask");a(this,"children");a(this,"_tag","IndexedNode");this.edit=e,this.mask=n,this.children=r}modify(e,n,r,s,i,o){const c=this.mask,u=this.children,f=ye(n,s),d=ie(f),g=xa(c,d),p=c&d,m=$r(this,e);if(!p){const j=new xt().modify(e,n+zt,r,s,i,o);return j?u.length>=$d?Ad(e,f,j,c,u):new Se(e,c|d,Fd(m,g,j,u)):this}const _=u[g],M=_.modify(e,n+zt,r,s,i,o);if(_===M)return this;let T=c,J;if(dt(M)){if(T&=~d,!T)return new xt;if(u.length<=2&&Td(u[g^1]))return u[g^1];J=ja(m,g,u)}else J=ae(m,g,M,u);return m?(this.mask=T,this.children=J,this):new Se(e,T,J)}}class si{constructor(e,n,r){a(this,"edit");a(this,"size");a(this,"children");a(this,"_tag","ArrayNode");this.edit=e,this.size=n,this.children=r}modify(e,n,r,s,i,o){let c=this.size;const u=this.children,f=ye(n,s),d=u[f],g=(d||new xt).modify(e,n+zt,r,s,i,o);if(d===g)return this;const p=$r(this,e);let m;if(dt(d)&&!dt(g))++c,m=ae(p,f,g,u);else if(!dt(d)&&dt(g)){if(--c,c<=Md)return Nd(e,c,f,u);m=ae(p,f,new xt,u)}else m=ae(p,f,g,u);return p?(this.size=c,this.children=m,this):new si(e,c,m)}}function Nd(t,e,n,r){const s=new Array(e-1);let i=0,o=0;for(let c=0,u=r.length;c<u;++c)if(c!==n){const f=r[c];f&&!dt(f)&&(s[i++]=f,o|=1<<c)}return new Se(t,o,s)}function Ad(t,e,n,r,s){const i=[];let o=r,c=0;for(let u=0;o;++u)o&1&&(i[u]=s[c++]),o>>>=1;return i[e]=n,new si(t,c+1,i)}function Pd(t,e,n,r,s,i){if(n===s)return new ri(t,n,[i,r]);const o=ye(e,n),c=ye(e,s);if(o===c)return u=>new Se(t,ie(o)|ie(c),[u]);{const u=o<c?[r,i]:[i,r];return new Se(t,ie(o)|ie(c),u)}}function La(t,e,n,r,s,i){let o,c=e;for(;;){const u=Pd(t,c,n,r,s,i);if(typeof u=="function")o=Cd(u,o),c=c+zt;else{let f=u;for(;o!=null;)f=o.value(f),o=o.previous;return f}}}const Da="effect/HashMap",ps=Symbol.for(Da),xd={[ps]:ps,[Symbol.iterator](){return new Mr(this,(t,e)=>[t,e])},[w](){let t=b(Da);for(const e of this)t^=h(b(e[0]),$(b(e[1])));return A(this,t)},[v](t){if(Dd(t)){if(t._size!==this._size)return!1;for(const e of this){const n=h(t,oi(e[0],b(e[0])));if(X(n))return!1;if(!I(e[1],n.value))return!1}return!0}return!1},toString(){return K(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(U)}},[P](){return this.toJSON()},pipe(){return y(this,arguments)}},ii=(t,e,n,r)=>{const s=Object.create(xd);return s._editable=t,s._edit=e,s._root=n,s._size=r,s};class Mr{constructor(e,n){a(this,"map");a(this,"f");a(this,"v");this.map=e,this.f=n,this.v=qa(this.map._root,this.f,void 0)}next(){if(X(this.v))return{done:!0,value:void 0};const e=this.v.value;return this.v=nr(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new Mr(this.map,this.f)}}const nr=t=>t?Ua(t[0],t[1],t[2],t[3],t[4]):k(),qa=(t,e,n=void 0)=>{switch(t._tag){case"LeafNode":return kt(t.value)?R({value:e(t.key,t.value.value),cont:n}):nr(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=t.children;return Ua(r.length,r,0,e,n)}default:return nr(n)}},Ua=(t,e,n,r,s)=>{for(;n<t;){const i=e[n++];if(i&&!dt(i))return qa(i,r,[t,e,n,r,s])}return nr(s)},jd=ii(!1,0,new xt,0),Rr=()=>jd,Ld=t=>{const e=Va(Rr());for(const n of t)tn(e,n[0],n[1]);return Kd(e)},Dd=t=>E(t,ps),qd=t=>t&&dt(t._root),Ud=l(2,(t,e)=>oi(t,e,b(e))),oi=l(3,(t,e,n)=>{let r=t._root,s=0;for(;;)switch(r._tag){case"LeafNode":return I(e,r.key)?r.value:k();case"CollisionNode":{if(n===r.hash){const i=r.children;for(let o=0,c=i.length;o<c;++o){const u=i[o];if("key"in u&&I(e,u.key))return u.value}}return k()}case"IndexedNode":{const i=ye(s,n),o=ie(i);if(r.mask&o){r=r.children[xa(r.mask,o)],s+=zt;break}return k()}case"ArrayNode":{if(r=r.children[ye(s,n)],r){s+=zt;break}return k()}default:return k()}}),Bd=l(2,(t,e)=>kt(oi(t,e,b(e)))),tn=l(3,(t,e,n)=>ci(t,e,()=>R(n))),Vd=l(3,(t,e,n)=>t._editable?(t._root=e,t._size=n,t):e===t._root?t:ii(t._editable,t._edit,e,n)),Ba=t=>new Mr(t,e=>e),ms=t=>t._size,Va=t=>ii(!0,t._edit+1,t._root,t._size),Kd=t=>(t._editable=!1,t),ci=l(3,(t,e,n)=>Jd(t,e,b(e),n)),Jd=l(4,(t,e,n,r)=>{const s={value:t._size},i=t._root.modify(t._editable?t._edit:NaN,0,r,n,e,s);return h(t,Vd(i,s.value))}),lo=l(2,(t,e)=>ci(t,e,k)),Hd=l(2,(t,e)=>Cr(t,Rr(),(n,r,s)=>tn(n,s,e(r,s)))),Gd=l(2,(t,e)=>Cr(t,void 0,(n,r,s)=>e(r,s))),Cr=l(3,(t,e,n)=>{const r=t._root;if(r._tag==="LeafNode")return kt(r.value)?n(e,r.value.value,r.key):e;if(r._tag==="EmptyNode")return e;const s=[r.children];let i;for(;i=s.pop();)for(let o=0,c=i.length;o<c;){const u=i[o++];u&&!dt(u)&&(u._tag==="LeafNode"?kt(u.value)&&(e=n(e,u.value.value,u.key)):s.push(u.children))}return e}),Ka="effect/HashSet",_s=Symbol.for(Ka),Wd={[_s]:_s,[Symbol.iterator](){return Ba(this._keyMap)},[w](){return A(this,$(b(this._keyMap))(b(Ka)))},[v](t){return Yd(t)?ms(this._keyMap)===ms(t._keyMap)&&I(this._keyMap,t._keyMap):!1},toString(){return K(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(U)}},[P](){return this.toJSON()},pipe(){return y(this,arguments)}},Fr=t=>{const e=Object.create(Wd);return e._keyMap=t,e},Yd=t=>E(t,_s),zd=Fr(Rr()),Tr=()=>zd,Qd=t=>{const e=ai(Tr());for(const n of t)en(e,n);return ui(e)},Xd=(...t)=>{const e=ai(Tr());for(const n of t)en(e,n);return ui(e)},Zd=l(2,(t,e)=>Bd(t._keyMap,e)),tg=t=>ms(t._keyMap),ai=t=>Fr(Va(t._keyMap)),ui=t=>(t._keyMap._editable=!1,t),Ja=l(2,(t,e)=>{const n=ai(t);return e(n),ui(n)}),en=l(2,(t,e)=>t._keyMap._editable?(tn(e,!0)(t._keyMap),t):Fr(tn(e,!0)(t._keyMap))),Ha=l(2,(t,e)=>t._keyMap._editable?(lo(e)(t._keyMap),t):Fr(lo(e)(t._keyMap))),eg=l(2,(t,e)=>Ja(t,n=>{for(const r of e)Ha(n,r)})),ng=l(2,(t,e)=>Ja(Tr(),n=>{rg(t,r=>en(n,r));for(const r of e)en(n,r)})),rg=l(2,(t,e)=>Gd(t._keyMap,(n,r)=>e(r))),sg=l(3,(t,e,n)=>Cr(t._keyMap,e,(r,s,i)=>n(r,i))),Qt=Tr,ig=Qd,li=Xd,og=Zd,Ga=tg,Qe=en,Wa=Ha,fo=eg,nn=ng,rr=sg,ho=Symbol.for("effect/MutableRef"),cg={[ho]:ho,toString(){return K(this.toJSON())},toJSON(){return{_id:"MutableRef",current:U(this.current)}},[P](){return this.toJSON()},pipe(){return y(this,arguments)}},Ya=t=>{const e=Object.create(cg);return e.current=t,e},Nr=t=>t.current,za=l(2,(t,e)=>(t.current=e,t)),fi="effect/FiberId",rn=Symbol.for(fi),sr="None",bs="Runtime",ag="Composite",ug=x(`${fi}-${sr}`);var ic;let lg=class{constructor(){a(this,ic,rn);a(this,"_tag",sr);a(this,"id",-1);a(this,"startTimeMillis",-1)}[(ic=rn,w)](){return ug}[v](e){return Qa(e)&&e._tag===sr}toString(){return K(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[P](){return this.toJSON()}};var oc;class fg{constructor(e,n){a(this,"id");a(this,"startTimeMillis");a(this,oc,rn);a(this,"_tag",bs);this.id=e,this.startTimeMillis=n}[(oc=rn,w)](){return A(this,x(`${fi}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[v](e){return Qa(e)&&e._tag===bs&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return K(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[P](){return this.toJSON()}}const hg=new lg,Qa=t=>E(t,rn),ys=t=>{switch(t._tag){case sr:return Qt();case bs:return li(t.id);case ag:return h(ys(t.left),nn(ys(t.right)))}},go=C(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Ya(0)),Xa=t=>Array.from(ys(t)).map(n=>`#${n}`).join(","),dg=()=>{const t=Nr(go);return h(go,za(t+1)),new fg(t,Date.now())},ke=hg,gg=Xa,Za=dg,hi=Rr,pg=Ld,mg=qd,tu=Ud,eu=tn,nu=Ba,_g=ci,bg=Hd,ru=Cr,sn=Symbol.for("effect/List"),Ss=t=>V(t),yg=t=>pf(Zs(t),Ss),Sg=yg(I),kg={[sn]:sn,_tag:"Cons",toString(){return K(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Ss(this).map(U)}},[P](){return this.toJSON()},[v](t){return iu(t)&&this._tag===t._tag&&Sg(this,t)},[w](){return A(this,hn(Ss(this)))},[Symbol.iterator](){let t=!1,e=this;return{next(){if(t)return this.return();if(e._tag==="Nil")return t=!0,this.return();const n=e.head;return e=e.tail,{done:t,value:n}},return(n){return t||(t=!0),{done:!0,value:n}}}},pipe(){return y(this,arguments)}},ir=(t,e)=>{const n=Object.create(kg);return n.head=t,n.tail=e,n},vg=x("Nil"),Ig={[sn]:sn,_tag:"Nil",toString(){return K(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[P](){return this.toJSON()},[w](){return vg},[v](t){return iu(t)&&this._tag===t._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return y(this,arguments)}},su=Object.create(Ig),iu=t=>E(t,sn),Ft=t=>t._tag==="Nil",wg=t=>t._tag==="Cons",Og=()=>su,Xt=(t,e)=>ir(t,e),ve=Og,di=t=>ir(t,su),Eg=l(2,(t,e)=>Mg(e,t)),$g=l(2,(t,e)=>Xt(e,t)),Mg=l(2,(t,e)=>{if(Ft(t))return e;if(Ft(e))return t;{const n=ir(e.head,t);let r=n,s=e.tail;for(;!Ft(s);){const i=ir(s.head,t);r.tail=i,r=i,s=s.tail}return n}}),Rg=l(3,(t,e,n)=>{let r=e,s=t;for(;!Ft(s);)r=n(r,s.head),s=s.tail;return r}),Cg=t=>{let e=ve(),n=t;for(;!Ft(n);)e=$g(e,n.head),n=n.tail;return e},gi=function(){function t(e){e&&Object.assign(this,e)}return t.prototype=Ys,t}(),Fg=Symbol.for("effect/DifferContextPatch");function po(t){return t}const mn={...gi.prototype,[Fg]:{_Value:po,_Patch:po}},Tg=Object.assign(Object.create(mn),{_tag:"Empty"}),Ng=Object.create(Tg),ou=()=>Ng,Ag=Object.assign(Object.create(mn),{_tag:"AndThen"}),Pg=(t,e)=>{const n=Object.create(Ag);return n.first=t,n.second=e,n},xg=Object.assign(Object.create(mn),{_tag:"AddService"}),jg=(t,e)=>{const n=Object.create(xg);return n.key=t,n.service=e,n},Lg=Object.assign(Object.create(mn),{_tag:"RemoveService"}),Dg=t=>{const e=Object.create(Lg);return e.key=t,e},qg=Object.assign(Object.create(mn),{_tag:"UpdateService"}),Ug=(t,e)=>{const n=Object.create(qg);return n.key=t,n.update=e,n},Bg=(t,e)=>{const n=new Map(t.unsafeMap);let r=ou();for(const[s,i]of e.unsafeMap.entries())if(n.has(s)){const o=n.get(s);n.delete(s),I(o,i)||(r=Bn(Ug(s,()=>i))(r))}else n.delete(s),r=Bn(jg(s,i))(r);for(const[s]of n.entries())r=Bn(Dg(s))(r);return r},Bn=l(2,(t,e)=>Pg(t,e)),Vg=l(2,(t,e)=>{if(t._tag==="Empty")return e;let n=!1,r=nt(t);const s=new Map(e.unsafeMap);for(;_e(r);){const o=be(r),c=Bt(r);switch(o._tag){case"Empty":{r=c;break}case"AddService":{s.set(o.key,o.service),r=c;break}case"AndThen":{r=gt(gt(c,o.second),o.first);break}case"RemoveService":{s.delete(o.key),r=c;break}case"UpdateService":{s.set(o.key,o.update(s.get(o.key))),n=!0,r=c;break}}}if(!n)return pe(s);const i=new Map;for(const[o]of e.unsafeMap)s.has(o)&&(i.set(o,s.get(o)),s.delete(o));for(const[o,c]of s)i.set(o,c);return pe(i)}),Kg=Symbol.for("effect/DifferHashSetPatch");function Xr(t){return t}const Ar={...gi.prototype,[Kg]:{_Value:Xr,_Key:Xr,_Patch:Xr}},Jg=Object.assign(Object.create(Ar),{_tag:"Empty"}),Hg=Object.create(Jg),cu=()=>Hg,Gg=Object.assign(Object.create(Ar),{_tag:"AndThen"}),Wg=(t,e)=>{const n=Object.create(Gg);return n.first=t,n.second=e,n},Yg=Object.assign(Object.create(Ar),{_tag:"Add"}),zg=t=>{const e=Object.create(Yg);return e.value=t,e},Qg=Object.assign(Object.create(Ar),{_tag:"Remove"}),Xg=t=>{const e=Object.create(Qg);return e.value=t,e},Zg=(t,e)=>{const[n,r]=rr([t,cu()],([s,i],o)=>og(o)(s)?[Wa(o)(s),i]:[s,ks(zg(o))(i)])(e);return rr(r,(s,i)=>ks(Xg(i))(s))(n)},ks=l(2,(t,e)=>Wg(t,e)),tp=l(2,(t,e)=>{if(t._tag==="Empty")return e;let n=e,r=nt(t);for(;_e(r);){const s=be(r),i=Bt(r);switch(s._tag){case"Empty":{r=i;break}case"AndThen":{r=gt(s.first)(gt(s.second)(i));break}case"Add":{n=Qe(s.value)(n),r=i;break}case"Remove":n=Wa(s.value)(n),r=i}}return n}),ep=Symbol.for("effect/DifferReadonlyArrayPatch");function mo(t){return t}const _n={...gi.prototype,[ep]:{_Value:mo,_Patch:mo}},np=Object.assign(Object.create(_n),{_tag:"Empty"}),rp=Object.create(np),au=()=>rp,sp=Object.assign(Object.create(_n),{_tag:"AndThen"}),ip=(t,e)=>{const n=Object.create(sp);return n.first=t,n.second=e,n},op=Object.assign(Object.create(_n),{_tag:"Append"}),cp=t=>{const e=Object.create(op);return e.values=t,e},ap=Object.assign(Object.create(_n),{_tag:"Slice"}),up=(t,e)=>{const n=Object.create(ap);return n.from=t,n.until=e,n},lp=Object.assign(Object.create(_n),{_tag:"Update"}),fp=(t,e)=>{const n=Object.create(lp);return n.index=t,n.patch=e,n},hp=t=>{let e=0,n=au();for(;e<t.oldValue.length&&e<t.newValue.length;){const r=t.oldValue[e],s=t.newValue[e],i=t.differ.diff(r,s);I(i,t.differ.empty)||(n=Vn(n,fp(e,i))),e=e+1}return e<t.oldValue.length&&(n=Vn(n,up(0,e))),e<t.newValue.length&&(n=Vn(n,cp(kh(e)(t.newValue)))),n},Vn=l(2,(t,e)=>ip(t,e)),dp=l(3,(t,e,n)=>{if(t._tag==="Empty")return e;let r=e.slice(),s=ft(t);for(;ph(s);){const i=tt(s),o=de(s);switch(i._tag){case"Empty":{s=o;break}case"AndThen":{o.unshift(i.first,i.second),s=o;break}case"Append":{for(const c of i.values)r.push(c);s=o;break}case"Slice":{r=r.slice(i.from,i.until),s=o;break}case"Update":{r[i.index]=n.patch(i.patch,r[i.index]),s=o;break}}}return r}),gp=Symbol.for("effect/Differ"),pp={[gp]:{_P:B,_V:B},pipe(){return y(this,arguments)}},Te=t=>{const e=Object.create(pp);return e.empty=t.empty,e.diff=t.diff,e.combine=t.combine,e.patch=t.patch,e},mp=()=>Te({empty:ou(),combine:(t,e)=>Bn(e)(t),diff:(t,e)=>Bg(t,e),patch:(t,e)=>Vg(e)(t)}),_p=()=>Te({empty:cu(),combine:(t,e)=>ks(e)(t),diff:(t,e)=>Zg(t,e),patch:(t,e)=>tp(e)(t)}),bp=t=>Te({empty:au(),combine:(e,n)=>Vn(e,n),diff:(e,n)=>hp({oldValue:e,newValue:n,differ:t}),patch:(e,n)=>dp(e,n,t)}),uu=()=>yp((t,e)=>e),yp=t=>Te({empty:B,combine:(e,n)=>e===B?n:n===B?e:r=>n(e(r)),diff:(e,n)=>I(e,n)?B:yr(n),patch:(e,n)=>t(n,e(n))}),on=255,lu=8,vs=t=>t&on,Is=t=>t>>lu&on,bn=(t,e)=>(t&on)+((e&t&on)<<lu),Sp=bn(0,0),kp=t=>bn(t,t),vp=t=>bn(t,0),Ip=l(2,(t,e)=>bn(vs(t)&~e,Is(t))),wp=l(2,(t,e)=>t|e),Op=t=>~t>>>0&on,Ep=0,Ne=1,$p=2,fu=4,ws=16,hu=32,Mp=t=>Pr(t,hu),Rp=l(2,(t,e)=>t|e),At=t=>du(t)&&!Fp(t),du=t=>Pr(t,Ne),Pr=l(2,(t,e)=>(t&e)!==0),gu=(...t)=>t.reduce((e,n)=>e|n,0),Cp=gu(Ep),_o=t=>Pr(t,fu),Fp=t=>Pr(t,ws),Kn=l(2,(t,e)=>bn(t^e,e)),Jn=l(2,(t,e)=>t&(Op(vs(e))|Is(e))|vs(e)&Is(e)),bo=Te({empty:Sp,diff:(t,e)=>Kn(t,e),combine:(t,e)=>wp(e)(t),patch:(t,e)=>Jn(e,t)}),Tp=kp,pu=vp,yo=Ip,mu=(t,e)=>({_tag:"Par",left:t,right:e}),Pn=(t,e)=>({_tag:"Seq",left:t,right:e}),Np=t=>{let e=di(t),n=ve();for(;;){const[r,s]=Rg(e,[_u(),ve()],([i,o],c)=>{const[u,f]=Ap(c);return[Dp(i,u),Eg(o,f)]});if(n=Pp(n,r),Ft(s))return Cg(n);e=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},Ap=t=>{let e=t,n=_u(),r=ve(),s=ve();for(;;)switch(e._tag){case"Empty":{if(Ft(r))return[n,s];e=r.head,r=r.tail;break}case"Par":{r=Xt(e.right,r),e=e.left;break}case"Seq":{const i=e.left,o=e.right;switch(i._tag){case"Empty":{e=o;break}case"Par":{const c=i.left,u=i.right;e=mu(Pn(c,o),Pn(u,o));break}case"Seq":{const c=i.left,u=i.right;e=Pn(c,Pn(u,o));break}case"Single":{e=i,s=Xt(o,s);break}}break}case"Single":{if(n=Lp(n,e),Ft(r))return[n,s];e=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},Pp=(t,e)=>{if(Ft(t))return di(Zr(e));if(qp(e))return t;const n=Hp(t.head),r=Up(e);return n.length===1&&r.length===1&&I(n[0],r[0])?Xt(Jp(t.head,Zr(e)),t.tail):Xt(Zr(e),t)},xp=Symbol.for("effect/RequestBlock/RequestBlockParallel"),jp={_R:t=>t};var cc;cc=xp;class pi{constructor(e){a(this,"map");a(this,cc,jp);this.map=e}}const _u=()=>new pi(hi()),Lp=(t,e)=>new pi(_g(t.map,e.dataSource,n=>rh(sh(n,id(e.blockedRequest)),()=>nt(e.blockedRequest)))),Dp=(t,e)=>new pi(ru(t.map,e.map,(n,r,s)=>eu(n,s,zs(tu(n,s),{onNone:()=>r,onSome:i=>ht(r,i)})))),qp=t=>mg(t.map),Up=t=>Array.from(nu(t.map)),Zr=t=>Kp(bg(t.map,e=>nt(e))),Bp=Symbol.for("effect/RequestBlock/RequestBlockSequential"),Vp={_R:t=>t};var ac;ac=Bp;class bu{constructor(e){a(this,"map");a(this,ac,Vp);this.map=e}}const Kp=t=>new bu(t),Jp=(t,e)=>new bu(ru(e.map,t.map,(n,r,s)=>eu(n,s,zs(tu(n,s),{onNone:()=>Nt(),onSome:i=>ht(i,r)})))),Hp=t=>Array.from(nu(t.map)),Gp=t=>Array.from(t.map),yn="Die",Zt="Empty",Ae="Fail",Pe="Interrupt",Ie="Parallel",we="Sequential",yu="effect/Cause",Su=Symbol.for(yu),Wp={_E:t=>t},xe={[Su]:Wp,[w](){return h(b(yu),$(b(cm(this))),A(this))},[v](t){return Yp(t)&&om(this,t)},pipe(){return y(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:U(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:U(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:U(this.left),right:U(this.right)}}},toString(){return Sn(this)},[P](){return this.toJSON()}},cn=(()=>{const t=Object.create(xe);return t._tag=Zt,t})(),or=t=>{const e=Object.create(xe);return e._tag=Ae,e.error=t,e},Tt=t=>{const e=Object.create(xe);return e._tag=yn,e.defect=t,e},Pt=t=>{const e=Object.create(xe);return e._tag=Pe,e.fiberId=t,e},xr=(t,e)=>{const n=Object.create(xe);return n._tag=Ie,n.left=t,n.right=e,n},ot=(t,e)=>{const n=Object.create(xe);return n._tag=we,n.left=t,n.right=e,n},Yp=t=>E(t,Su),zp=t=>t._tag===Zt,Qp=t=>t._tag===Zt?!0:Oe(t,!0,(e,n)=>{switch(n._tag){case Zt:return R(e);case yn:case Ae:case Pe:return R(!1);default:return k()}}),Xp=t=>kt(sm(t)),mi=t=>_i(void 0,um)(t),Zp=t=>me(Oe(t,Nt(),(e,n)=>n._tag===Ae?R(h(e,gt(n.error))):k())),tm=t=>me(Oe(t,Nt(),(e,n)=>n._tag===yn?R(h(e,gt(n.defect))):k())),em=t=>Oe(t,Qt(),(e,n)=>n._tag===Pe?R(h(e,Qe(n.fiberId))):k()),nm=t=>ku(t,e=>e._tag===Ae?R(e.error):k()),rm=t=>{const e=nm(t);switch(e._tag){case"None":return Ct(t);case"Some":return he(e.value)}},sm=t=>ku(t,e=>e._tag===Pe?R(e.fiberId):k()),So=t=>vu(t,{onEmpty:cn,onFail:()=>cn,onDie:Tt,onInterrupt:Pt,onSequential:ot,onParallel:xr}),im=t=>vu(t,{onEmpty:cn,onFail:Tt,onDie:Tt,onInterrupt:Pt,onSequential:ot,onParallel:xr}),om=(t,e)=>{let n=nt(t),r=nt(e);for(;_e(n)&&_e(r);){const[s,i]=h(be(n),Oe([Qt(),Nt()],([u,f],d)=>{const[g,p]=Os(d);return R([h(u,nn(g)),h(f,ht(p))])})),[o,c]=h(be(r),Oe([Qt(),Nt()],([u,f],d)=>{const[g,p]=Os(d);return R([h(u,nn(g)),h(f,ht(p))])}));if(!I(s,o))return!1;n=i,r=c}return!0},cm=t=>am(nt(t),Nt()),am=(t,e)=>{for(;;){const[n,r]=h(t,ya([Qt(),Nt()],([i,o],c)=>{const[u,f]=Os(c);return[h(i,nn(u)),h(o,ht(f))]})),s=Ga(n)>0?h(e,gt(n)):e;if(od(r))return me(s);t=r,e=s}throw new Error(Ir("Cause.flattenCauseLoop"))},ku=l(2,(t,e)=>{const n=[t];for(;n.length>0;){const r=n.pop(),s=e(r);switch(s._tag){case"None":{switch(r._tag){case we:case Ie:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return k()}),Os=t=>{let e=t;const n=[];let r=Qt(),s=Nt();for(;e!==void 0;)switch(e._tag){case Zt:{if(n.length===0)return[r,s];e=n.pop();break}case Ae:{if(r=Qe(r,zr(e._tag,e.error)),n.length===0)return[r,s];e=n.pop();break}case yn:{if(r=Qe(r,zr(e._tag,e.defect)),n.length===0)return[r,s];e=n.pop();break}case Pe:{if(r=Qe(r,zr(e._tag,e.fiberId)),n.length===0)return[r,s];e=n.pop();break}case we:{switch(e.left._tag){case Zt:{e=e.right;break}case we:{e=ot(e.left.left,ot(e.left.right,e.right));break}case Ie:{e=xr(ot(e.left.left,e.right),ot(e.left.right,e.right));break}default:{s=gt(s,e.right),e=e.left;break}}break}case Ie:{n.push(e.right),e=e.left;break}}throw new Error(Ir("Cause.evaluateCauseLoop"))},um={emptyCase:eo,failCase:is,dieCase:is,interruptCase:eo,sequentialCase:(t,e,n)=>e&&n,parallelCase:(t,e,n)=>e&&n},ko="SequentialCase",vo="ParallelCase",vu=l(2,(t,{onDie:e,onEmpty:n,onFail:r,onInterrupt:s,onParallel:i,onSequential:o})=>_i(t,void 0,{emptyCase:()=>n,failCase:(c,u)=>r(u),dieCase:(c,u)=>e(u),interruptCase:(c,u)=>s(u),sequentialCase:(c,u,f)=>o(u,f),parallelCase:(c,u,f)=>i(u,f)})),Oe=l(3,(t,e,n)=>{let r=e,s=t;const i=[];for(;s!==void 0;){const o=n(r,s);switch(r=kt(o)?o.value:r,s._tag){case we:{i.push(s.right),s=s.left;break}case Ie:{i.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&i.length>0&&(s=i.pop())}return r}),_i=l(3,(t,e,n)=>{const r=[t],s=[];for(;r.length>0;){const o=r.pop();switch(o._tag){case Zt:{s.push(Ct(n.emptyCase(e)));break}case Ae:{s.push(Ct(n.failCase(e,o.error)));break}case yn:{s.push(Ct(n.dieCase(e,o.defect)));break}case Pe:{s.push(Ct(n.interruptCase(e,o.fiberId)));break}case we:{r.push(o.right),r.push(o.left),s.push(he({_tag:ko}));break}case Ie:{r.push(o.right),r.push(o.left),s.push(he({_tag:vo}));break}}}const i=[];for(;s.length>0;){const o=s.pop();switch(o._tag){case"Left":{switch(o.left._tag){case ko:{const c=i.pop(),u=i.pop(),f=n.sequentialCase(e,c,u);i.push(f);break}case vo:{const c=i.pop(),u=i.pop(),f=n.parallelCase(e,c,u);i.push(f);break}}break}case"Right":{i.push(o.right);break}}}if(i.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return i.pop()}),Sn=(t,e)=>mi(t)?"All fibers interrupted without errors.":wu(t).map(function(n){return(e==null?void 0:e.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${Iu(n.cause,"  ")}
}`}).join(`
`),Iu=(t,e)=>{const n=t.stack.split(`
`);let r=`${e}[cause]: ${n[0]}`;for(let s=1,i=n.length;s<i;s++)r+=`
${e}${n[s]}`;return t.cause&&(r+=` {
${Iu(t.cause,`${e}  `)}
${e}}`),r};class cr extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(lm(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new cr(n.cause)}:void 0);a(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(Ee in n&&(this.span=n[Ee]),Object.keys(n).forEach(i=>{i in this||(this[i]=n[i])})),this.stack=dm(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const lm=t=>{if(typeof t=="string")return t;if(typeof t=="object"&&t!==null&&t instanceof Error)return t.message;try{if(E(t,"toString")&&kr(t.toString)&&t.toString!==Object.prototype.toString&&t.toString!==globalThis.Array.prototype.toString)return t.toString()}catch{}return Xc(t)},fm=/\((.*)\)/g,hm=C("effect/Tracer/spanToTrace",()=>new WeakMap),dm=(t,e,n)=>{const r=[t],s=e.startsWith(t)?e.slice(t.length).split(`
`):e.split(`
`);for(let i=1;i<s.length&&!s[i].includes("Generator.next");i++){if(s[i].includes("effect_internal_function")){r.pop();break}r.push(s[i].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let i=n,o=0;for(;i&&i._tag==="Span"&&o<10;){const c=hm.get(i);if(typeof c=="function"){const u=c();if(typeof u=="string"){const f=u.matchAll(fm);let d=!1;for(const[,g]of f)d=!0,r.push(`    at ${i.name} (${g})`);d||r.push(`    at ${i.name} (${u.replace(/^at /,"")})`)}else r.push(`    at ${i.name}`)}else r.push(`    at ${i.name}`);i=qt(i.parent),o++}}return r.join(`
`)},Ee=Symbol.for("effect/SpanAnnotation"),wu=t=>_i(t,void 0,{emptyCase:()=>[],dieCase:(e,n)=>[new cr(n)],failCase:(e,n)=>[new cr(n)],interruptCase:()=>[],parallelCase:(e,n,r)=>[...n,...r],sequentialCase:(e,n,r)=>[...n,...r]}),jr="Pending",Ou="Done",gm="effect/Deferred",pm=Symbol.for(gm),mm={_E:t=>t,_A:t=>t},_m=t=>({_tag:jr,joiners:t}),bm=t=>({_tag:Ou,effect:t});class kn{constructor(e){a(this,"self");a(this,"called",!1);this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new kn(this.self)}}const Eu=(t,e)=>{const n=new G("Blocked");return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n},ym=t=>{const e=new G("RunBlocked");return e.effect_instruction_i0=t,e},$e=Symbol.for("effect/Effect");class Sm{constructor(e,n){a(this,"patch");a(this,"op");a(this,"_op",Ws);this.patch=e,this.op=n}}var uc;class G{constructor(e){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,uc,fe);this._op=e}[(uc=$e,v)](e){return this===e}[w](){return A(this,Ks(this))}pipe(){return y(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:U(this.effect_instruction_i0),effect_instruction_i1:U(this.effect_instruction_i1),effect_instruction_i2:U(this.effect_instruction_i2)}}toString(){return K(this.toJSON())}[P](){return this.toJSON()}[Symbol.iterator](){return new kn(new fn(this))}}var lc;class $u{constructor(e){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,lc,fe);this._op=e,this._tag=e}[(lc=$e,v)](e){return Mi(e)&&e._op==="Failure"&&I(this.effect_instruction_i0,e.effect_instruction_i0)}[w](){return h(x(this._tag),$(b(this.effect_instruction_i0)),A(this))}get cause(){return this.effect_instruction_i0}pipe(){return y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return K(this.toJSON())}[P](){return this.toJSON()}[Symbol.iterator](){return new kn(new fn(this))}}var fc;class Mu{constructor(e){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,fc,fe);this._op=e,this._tag=e}[(fc=$e,v)](e){return Mi(e)&&e._op==="Success"&&I(this.effect_instruction_i0,e.effect_instruction_i0)}[w](){return h(x(this._tag),$(b(this.effect_instruction_i0)),A(this))}get value(){return this.effect_instruction_i0}pipe(){return y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:U(this.value)}}toString(){return K(this.toJSON())}[P](){return this.toJSON()}[Symbol.iterator](){return new kn(new fn(this))}}const bi=t=>E(t,$e),lt=t=>{const e=new G(ea);return e.effect_instruction_i0=t,e},km=l(3,(t,e,n)=>Lr(r=>O(t,s=>O(Fu(H(()=>r(e(s)))),i=>H(()=>n(s,i)).pipe(Me({onFailure:o=>{switch(i._tag){case at:return pt(ot(i.effect_instruction_i0,o));case ut:return pt(o)}},onSuccess:()=>i})))))),vn=l(2,(t,e)=>O(t,()=>N(e))),In=t=>vn(t,void 0),Ru=function(){const t=new G(Or);switch(arguments.length){case 2:{t.effect_instruction_i0=arguments[0],t.commit=arguments[1];break}case 3:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.commit=arguments[2];break}case 4:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.effect_instruction_i2=arguments[2],t.commit=arguments[3];break}default:throw new Error(Ir("you're not supposed to end up here"))}return t},ar=(t,e=ke)=>{const n=new G(We);let r;return n.effect_instruction_i0=s=>{r=t(s)},n.effect_instruction_i1=e,ju(n,s=>bi(r)?r:It)},vm=(t,e=ke)=>H(()=>ar(t,e)),an=(t,e=ke)=>Ru(t,function(){let n,r;function s(u){n?n(u):r===void 0&&(r=u)}const i=new G(We);i.effect_instruction_i0=u=>{n=u,r&&u(r)},i.effect_instruction_i1=e;let o,c;return this.effect_instruction_i0.length!==1?(c=new AbortController,o=z(()=>this.effect_instruction_i0(s,c.signal))):o=z(()=>this.effect_instruction_i0(s)),o||c?ju(i,u=>(c&&c.abort(),o??It)):i}),Io=l(2,(t,e)=>yi(t,{onFailure:e,onSuccess:N})),wo=Symbol.for("effect/OriginalAnnotation"),Cu=(t,e)=>kt(e)?new Proxy(t,{has(n,r){return r===Ee||r===wo||r in n},get(n,r){return r===Ee?e.value:r===wo?t:n[r]}}):t,Oo=t=>vr(t)&&!(Ee in t)?lt(e=>pt(Tt(Cu(t,Zu(e))))):pt(Tt(t)),Eo=t=>Im(()=>Tt(new t_(t))),Es=t=>yi(t,{onFailure:e=>N(he(e)),onSuccess:e=>N(Ct(e))}),Fu=t=>Om(t,{onFailure:F,onSuccess:D}),Q=t=>vr(t)&&!(Ee in t)?lt(e=>pt(or(Cu(t,Zu(e))))):pt(or(t)),Tu=t=>O(S(t),Q),pt=t=>{const e=new $u(at);return e.effect_instruction_i0=t,e},Im=t=>O(S(t),pt),wm=lt(t=>N(t.id())),Nu=t=>lt(e=>t(e.id())),O=l(2,(t,e)=>{const n=new G(zn);return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n}),Au=t=>O(t,B),Om=l(2,(t,e)=>Me(t,{onFailure:n=>N(e.onFailure(n)),onSuccess:n=>N(e.onSuccess(n))})),Me=l(2,(t,e)=>{const n=new G(Qn);return n.effect_instruction_i0=t,n.effect_instruction_i1=e.onFailure,n.effect_instruction_i2=e.onSuccess,n}),yi=l(2,(t,e)=>Me(t,{onFailure:n=>{if(tm(n).length>0)return pt(im(n));const s=Zp(n);return s.length>0?e.onFailure(Fa(s)):pt(n)},onSuccess:e.onSuccess})),Vt=l(2,(t,e)=>H(()=>{const n=V(t),r=Xs(n.length);let s=0;return vn(Ii({while:()=>s<n.length,body:()=>e(n[s],s),step:i=>{r[s++]=i}}),r)})),Si=l(2,(t,e)=>H(()=>{const n=V(t);let r=0;return Ii({while:()=>r<n.length,body:()=>e(n[r],r),step:()=>{r++}})})),Pu=t=>{const e=new G(dn);return e.effect_instruction_i0=Tp(Ne),e.effect_instruction_i1=()=>t,e},ct=l(2,(t,e)=>O(t,n=>S(()=>e(n)))),xu=l(2,(t,e)=>yi(t,{onFailure:n=>Tu(()=>e.onFailure(n)),onSuccess:n=>S(()=>e.onSuccess(n))})),ki=l(2,(t,e)=>Me(t,{onFailure:n=>{const r=rm(n);switch(r._tag){case"Left":return Tu(()=>e(r.left));case"Right":return pt(r.right)}},onSuccess:N})),vi=l(2,(t,e)=>Lr(n=>Me(n(t),{onFailure:r=>{const s=F(r);return Me(e(s),{onFailure:i=>F(ot(r,i)),onSuccess:()=>s})},onSuccess:r=>{const s=D(r);return Uu(e(s),s)}}))),ju=l(2,(t,e)=>vi(t,zu({onFailure:n=>mi(n)?In(e(em(n))):It,onSuccess:()=>It}))),N=t=>{const e=new Mu(ut);return e.effect_instruction_i0=t,e},H=t=>{const e=new G(Or);return e.commit=t,e},S=t=>{const e=new G(ta);return e.effect_instruction_i0=t,e},Em=l(t=>t.length===3||t.length===2&&!(vr(t[1])&&"onlyEffect"in t[1]),(t,e)=>O(t,n=>{const r=typeof e=="function"?e(n):e;return bi(r)?vn(r,n):kf(r)?ar(s=>{r.then(i=>s(N(n)),i=>s(Q(new r_(i,"An unknown error occurred in Effect.tap"))))}):N(n)})),$m=t=>lt(e=>{const n=e.getFiberRef(Ms),r=h(n,Yt(()=>e.scope()));return t(Ei(Ms,R(r)))}),Lu=t=>{const e=new G(dn);return e.effect_instruction_i0=pu(Ne),e.effect_instruction_i1=()=>t,e},Lr=t=>Ru(t,function(){const e=new G(dn);return e.effect_instruction_i0=pu(Ne),e.effect_instruction_i1=n=>du(n)?z(()=>this.effect_instruction_i0(Pu)):z(()=>this.effect_instruction_i0(Lu)),e}),It=N(void 0),Mm=t=>{const e=new G(dn);return e.effect_instruction_i0=t,e.effect_instruction_i1=void 0,e},Ii=t=>{const e=new G(Xn);return e.effect_instruction_i0=t.while,e.effect_instruction_i1=t.body,e.effect_instruction_i2=t.step,e},Rm=t=>H(()=>{const e=new G(Ye);return e.effect_instruction_i0=t(),e}),Cm=function(){const t=arguments.length===1?arguments[0]:arguments[1].bind(arguments[0]);return Rm(()=>t(h))},wi=t=>{const e=new G(qn);return typeof(t==null?void 0:t.priority)<"u"?Ym(e,t.priority):e},Du=l(2,(t,e)=>O(t,n=>ct(e,r=>[n,r]))),qu=l(2,(t,e)=>O(t,n=>vn(e,n))),Uu=l(2,(t,e)=>O(t,()=>e)),Fm=t=>O(wm,e=>h(t,Bu(e))),Bu=l(2,(t,e)=>O(t.interruptAsFork(e),()=>t.await)),Tm={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return y(this,arguments)}},Nm={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return y(this,arguments)}},Am={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return y(this,arguments)}},Pm={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return y(this,arguments)}},Vu={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return y(this,arguments)}},Ku={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return y(this,arguments)}},xm={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return y(this,arguments)}},jm={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return y(this,arguments)}},Lm="effect/FiberRef",Dm=Symbol.for(Lm),qm={_A:t=>t},Oi=t=>lt(e=>D(e.getFiberRef(t))),Ju=l(2,(t,e)=>O(Oi(t),e)),$o=l(2,(t,e)=>Um(t,()=>[void 0,e])),Um=l(2,(t,e)=>lt(n=>{const[r,s]=e(n.getFiberRef(t));return n.setFiberRef(t,s),N(r)})),Ei=l(3,(t,e,n)=>km(qu(Oi(e),$o(e,n)),()=>t,r=>$o(e,r))),mt=(t,e)=>je(t,{differ:uu(),fork:(e==null?void 0:e.fork)??B,join:e==null?void 0:e.join}),Bm=t=>{const e=_p();return je(t,{differ:e,fork:e.empty})},Vm=t=>{const e=bp(uu());return je(t,{differ:e,fork:e.empty})},Hu=t=>{const e=mp();return je(t,{differ:e,fork:e.empty})},je=(t,e)=>({...pn,[Dm]:qm,initial:t,commit(){return Oi(this)},diff:(r,s)=>e.differ.diff(r,s),combine:(r,s)=>e.differ.combine(r,s),patch:r=>s=>e.differ.patch(r,s),fork:e.fork,join:e.join??((r,s)=>s)}),Km=t=>je(t,{differ:bo,fork:bo.empty}),Dr=C(Symbol.for("effect/FiberRef/currentContext"),()=>Hu(ei())),$i=C(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>mt(0)),Jm=C(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>mt(2048)),Hm=C(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>mt(hi())),Gm=C(Symbol.for("effect/FiberRef/currentLogLevel"),()=>mt(Vu)),Wm=C(Symbol.for("effect/FiberRef/currentLogSpan"),()=>mt(ve())),Ym=l(2,(t,e)=>Ei(t,$i,e)),zm=C(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>mt(R(Ku))),$s=C(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>Vm(ge())),Ms=C(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>mt(k(),{fork:()=>k(),join:(t,e)=>t})),xn=C(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>mt(cn,{fork:()=>cn,join:(t,e)=>t})),Qm=(t,e)=>t.addFinalizer(()=>In(e)),Xm=(t,e)=>t.close(e),Zm=(t,e)=>t.fork(e),Gu=function(){class t extends globalThis.Error{commit(){return Q(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[P](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?Sn(or(this),{renderErrorCause:!0}):this}}return Object.assign(t.prototype,Vf),t}(),Wu=(t,e)=>{class n extends Gu{constructor(){super(...arguments);a(this,"_tag",e)}}return Object.assign(n.prototype,t),n.prototype.name=e,n},Mo=Symbol.for("effect/Cause/errors/RuntimeException"),t_=Wu({[Mo]:Mo},"RuntimeException"),e_=Symbol.for("effect/Cause/errors/InterruptedException"),n_=t=>E(t,e_),Ro=Symbol.for("effect/Cause/errors/NoSuchElement"),Yu=Wu({[Ro]:Ro},"NoSuchElementException"),Co=Symbol.for("effect/Cause/errors/UnknownException"),r_=function(){class t extends Gu{constructor(r,s){super(s??"An unknown error occurred",{cause:r});a(this,"_tag","UnknownException");a(this,"error");this.error=r}}return Object.assign(t.prototype,{[Co]:Co,name:"UnknownException"}),t}(),Mi=t=>bi(t)&&"_tag"in t&&(t._tag==="Success"||t._tag==="Failure"),Fo=(t,e)=>o_(t,e!=null&&e.parallel?xr:ot),To=t=>F(or(t)),F=t=>{const e=new $u(at);return e.effect_instruction_i0=t,e},s_=t=>F(Pt(t)),ts=l(2,(t,e)=>{switch(t._tag){case at:return F(t.effect_instruction_i0);case ut:return D(e(t.effect_instruction_i0))}}),zu=l(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case at:return e(t.effect_instruction_i0);case ut:return n(t.effect_instruction_i0)}}),D=t=>{const e=new Mu(ut);return e.effect_instruction_i0=t,e},Kt=D(void 0),i_=l(3,(t,e,{onFailure:n,onSuccess:r})=>{switch(t._tag){case at:switch(e._tag){case ut:return F(t.effect_instruction_i0);case at:return F(n(t.effect_instruction_i0,e.effect_instruction_i0))}case ut:switch(e._tag){case ut:return D(r(t.effect_instruction_i0,e.effect_instruction_i0));case at:return F(e.effect_instruction_i0)}}}),o_=(t,e)=>{const n=Ca(t);return _e(n)?h(Bt(n),ya(h(be(n),ts(nt)),(r,s)=>h(r,i_(s,{onSuccess:(i,o)=>h(i,gt(o)),onFailure:e}))),ts(me),ts(r=>Gt(r)),R):k()},c_=t=>({...pn,[pm]:mm,state:Ya(_m([])),commit(){return Qu(this)},blockingOn:t}),Qu=t=>vm(e=>{const n=Nr(t.state);switch(n._tag){case Ou:return e(n.effect);case jr:return n.joiners.push(e),a_(t,e)}},t.blockingOn),Xu=(t,e)=>{const n=Nr(t.state);if(n._tag===jr){za(t.state,bm(e));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](e)}},a_=(t,e)=>S(()=>{const n=Nr(t.state);if(n._tag===jr){const r=n.joiners.indexOf(e);r>=0&&n.joiners.splice(r,1)}}),Zu=t=>{const e=t.currentSpan;return e!==void 0&&e._tag==="Span"?R(e):k()},No=Symbol.for("effect/MutableHashMap"),u_={[No]:No,[Symbol.iterator](){return new Ri(this)},toString(){return K(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(U)}},[P](){return this.toJSON()},pipe(){return y(this,arguments)}};class Ri{constructor(e){a(this,"self");a(this,"referentialIterator");a(this,"bucketIterator");this.self=e,this.referentialIterator=e.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const e=this.referentialIterator.next();return e.done?(this.bucketIterator=new l_(this.self.buckets.values()),this.next()):e}[Symbol.iterator](){return new Ri(this.self)}}class l_{constructor(e){a(this,"backing");a(this,"currentBucket");this.backing=e}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const e=this.currentBucket.next();return e.done?(this.currentBucket=void 0,this.next()):e}}const f_=()=>{const t=Object.create(u_);return t.referential=new Map,t.buckets=new Map,t.bucketsSize=0,t},Ut=l(2,(t,e)=>{if(Yn(e)===!1)return t.referential.has(e)?R(t.referential.get(e)):k();const n=e[w](),r=t.buckets.get(n);return r===void 0?k():h_(t,r,e)}),h_=(t,e,n,r=!1)=>{for(let s=0,i=e.length;s<i;s++)if(n[v](e[s][0])){const o=e[s][1];return r&&(e.splice(s,1),t.bucketsSize--),R(o)}return k()},Ve=l(2,(t,e)=>kt(Ut(t,e))),Ke=l(3,(t,e,n)=>{if(Yn(e)===!1)return t.referential.set(e,n),t;const r=e[w](),s=t.buckets.get(r);return s===void 0?(t.buckets.set(r,[[e,n]]),t.bucketsSize++,t):(d_(t,s,e),s.push([e,n]),t.bucketsSize++,t)}),d_=(t,e,n)=>{for(let r=0,s=e.length;r<s;r++)if(n[v](e[r][0])){e.splice(r,1),t.bucketsSize--;return}},g_="effect/Clock",Ao=Symbol.for(g_),qr=Fe("effect/Clock"),p_=2**31-1,Po={unsafeSchedule(t,e){const n=gs(e);if(n>p_)return is;let r=!1;const s=setTimeout(()=>{r=!0,t()},n);return()=>(clearTimeout(s),!r)}},xo=function(){const t=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*t;if(typeof performance.timeOrigin=="number"&&performance.timeOrigin===0)return()=>BigInt(Math.round(performance.now()*1e6));const e=BigInt(Date.now())*t-BigInt(Math.round(performance.now()*1e6));return()=>e+BigInt(Math.round(performance.now()*1e6))}(),m_=function(){const t=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!t)return xo;const e=xo()-t.bigint();return()=>e+t.bigint()}();var hc;hc=Ao;class __{constructor(){a(this,hc,Ao);a(this,"currentTimeMillis",S(()=>this.unsafeCurrentTimeMillis()));a(this,"currentTimeNanos",S(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return m_()}scheduler(){return N(Po)}sleep(e){return an(n=>{const r=Po.unsafeSchedule(()=>n(It),e);return In(S(r))})}}const b_=()=>new __,tl="And",el="Or",nl="InvalidData",rl="MissingData",sl="SourceUnavailable",il="Unsupported",y_="effect/ConfigError",jo=Symbol.for(y_),Le={_tag:"ConfigError",[jo]:jo},ol=(t,e)=>{const n=Object.create(Le);return n._op=tl,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),n},cl=(t,e)=>{const n=Object.create(Le);return n._op=el,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),n},S_=(t,e,n={pathDelim:"."})=>{const r=Object.create(Le);return r._op=nl,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${h(this.path,Ce(n.pathDelim))}: "${this.message}")`}}),r},te=(t,e,n={pathDelim:"."})=>{const r=Object.create(Le);return r._op=rl,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${h(this.path,Ce(n.pathDelim))}: "${this.message}")`}}),r},k_=(t,e,n,r={pathDelim:"."})=>{const s=Object.create(Le);return s._op=sl,s.path=t,s.message=e,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${h(this.path,Ce(r.pathDelim))}: "${this.message}")`}}),s},v_=(t,e,n={pathDelim:"."})=>{const r=Object.create(Le);return r._op=il,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${h(this.path,Ce(n.pathDelim))}: "${this.message}")`}}),r},Jt=l(2,(t,e)=>{switch(t._op){case tl:return ol(Jt(t.left,e),Jt(t.right,e));case el:return cl(Jt(t.left,e),Jt(t.right,e));case nl:return S_([...e,...t.path],t.message);case rl:return te([...e,...t.path],t.message);case sl:return k_([...e,...t.path],t.message,t.cause);case il:return v_([...e,...t.path],t.message)}}),I_={_tag:"Empty"},es=l(2,(t,e)=>{let n=di(e),r=t;for(;wg(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=Xt(s.first,Xt(s.second,n.tail));break}case"MapName":{r=oe(r,s.f),n=n.tail;break}case"Nested":{r=Zn(r,s.name),n=n.tail;break}case"Unnested":{if(h(ze(r),ah(s.name)))r=de(r),n=n.tail;else return he(te(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return Ct(r)}),w_="Constant",O_="Fail",E_="Fallback",$_="Described",M_="Lazy",R_="MapOrFail",C_="Nested",F_="Primitive",T_="Sequence",N_="HashMap",A_="ZipWith";var Lo={};const ur=(t,e)=>[...t,...e],P_="effect/ConfigProvider",Do=Symbol.for(P_),x_=Fe("effect/ConfigProvider"),j_="effect/ConfigProviderFlat",qo=Symbol.for(j_),L_=t=>({[Do]:Do,pipe(){return y(this,arguments)},...t}),D_=t=>({[qo]:qo,patch:t.patch,load:(e,n,r=!0)=>t.load(e,n,r),enumerateChildren:t.enumerateChildren}),q_=t=>L_({load:e=>O(it(t,ge(),e,!1),n=>zs(ze(n),{onNone:()=>Q(te(ge(),`Expected a single value having structure: ${e}`)),onSome:N})),flattened:t}),U_=t=>{const{pathDelim:e,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},t),r=u=>h(u,Ce(e)),s=u=>u.split(e),i=()=>typeof process<"u"&&"env"in process&&typeof Lo=="object"?Lo:{};return q_(D_({load:(u,f,d=!0)=>{const g=r(u),p=i(),m=g in p?R(p[g]):k();return h(m,ki(()=>te(u,`Expected ${g} to exist in the process context`)),O(_=>H_(_,u,f,n,d)))},enumerateChildren:u=>S(()=>{const f=i(),p=Object.keys(f).map(m=>s(m.toUpperCase())).filter(m=>{for(let _=0;_<u.length;_++){const M=h(u,_a(_)),T=m[_];if(T===void 0||M!==T)return!1}return!0}).flatMap(m=>m.slice(u.length,u.length+1));return ig(p)}),patch:I_}))},B_=(t,e,n,r)=>{const s=io(n.length,u=>u>=r.length?k():R([t(u),u+1])),i=io(r.length,u=>u>=n.length?k():R([e(u),u+1])),o=ur(n,s),c=ur(r,i);return[o,c]},V_=(t,e)=>{let n=e;if(n._tag==="Nested"){const r=t.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return t},it=(t,e,n,r)=>{const s=n;switch(s._tag){case w_:return N(ft(s.value));case $_:return H(()=>it(t,e,s.config,r));case O_:return Q(te(e,s.message));case E_:return h(H(()=>it(t,e,s.first,r)),Io(i=>s.condition(i)?h(it(t,e,s.second,r),Io(o=>Q(cl(i,o)))):Q(i)));case M_:return H(()=>it(t,e,s.config(),r));case R_:return H(()=>h(it(t,e,s.original,r),O(Vt(i=>h(s.mapOrFail(i),ki(Jt(V_(e,s.original))))))));case C_:return H(()=>it(t,ur(e,ft(s.name)),s.config,r));case F_:return h(es(e,t.patch),O(i=>h(t.load(i,s,r),O(o=>{if(o.length===0){const c=h(bh(i),Yt(()=>"<n/a>"));return Q(te([],`Expected ${s.description} with name ${c}`))}return N(o)}))));case T_:return h(es(e,t.patch),O(i=>h(t.enumerateChildren(i),O(W_),O(o=>o.length===0?H(()=>ct(it(t,e,s.config,!0),ft)):h(Vt(o,c=>it(t,hh(e,`[${c}]`),s.config,!0)),ct(c=>{const u=Rh(c);return u.length===0?ft(ge()):ft(u)}))))));case N_:return H(()=>h(es(e,t.patch),O(i=>h(t.enumerateChildren(i),O(o=>h(o,Vt(c=>it(t,ur(i,ft(c)),s.valueConfig,r)),ct(c=>c.length===0?ft(hi()):h(G_(c),oe(u=>pg(so(V(o),u)))))))))));case A_:return H(()=>h(it(t,e,s.left,r),Es,O(i=>h(it(t,e,s.right,r),Es,O(o=>{if(Ge(i)&&Ge(o))return Q(ol(i.left,o.left));if(Ge(i)&&Nn(o))return Q(i.left);if(Nn(i)&&Ge(o))return Q(o.left);if(Nn(i)&&Nn(o)){const c=h(e,Ce(".")),u=K_(e,c),[f,d]=B_(u,u,h(i.right,oe(Ct)),h(o.right,oe(Ct)));return h(f,so(d),Vt(([g,p])=>h(Du(g,p),ct(([m,_])=>s.zip(m,_)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},K_=(t,e)=>n=>he(te(t,`The element at index ${n} in a sequence at path "${e}" was missing`)),J_=(t,e)=>t.split(new RegExp(`\\s*${Fh(e)}\\s*`)),H_=(t,e,n,r,s)=>s?h(J_(t,r),Vt(i=>n.parse(i.trim())),ki(Jt(e))):h(n.parse(t),xu({onFailure:Jt(e),onSuccess:ft})),G_=t=>Object.keys(t[0]).map(e=>t.map(n=>n[e])),W_=t=>h(Vt(t,z_),xu({onFailure:()=>ge(),onSuccess:tr(Ze)}),Es,ct(Zf)),Y_=/^(\[(\d+)\])$/,z_=t=>{const e=t.match(Y_);if(e!==null){const n=e[2];return h(n!==void 0&&n.length>0?R(n):k(),ih(Q_))}return k()},Q_=t=>{const e=Number.parseInt(t);return Number.isNaN(e)?k():R(e)},Uo=Symbol.for("effect/Console"),al=Fe("effect/Console"),X_={[Uo]:Uo,assert(t,...e){return S(()=>{console.assert(t,...e)})},clear:S(()=>{console.clear()}),count(t){return S(()=>{console.count(t)})},countReset(t){return S(()=>{console.countReset(t)})},debug(...t){return S(()=>{console.debug(...t)})},dir(t,e){return S(()=>{console.dir(t,e)})},dirxml(...t){return S(()=>{console.dirxml(...t)})},error(...t){return S(()=>{console.error(...t)})},group(t){return t!=null&&t.collapsed?S(()=>console.groupCollapsed(t==null?void 0:t.label)):S(()=>console.group(t==null?void 0:t.label))},groupEnd:S(()=>{console.groupEnd()}),info(...t){return S(()=>{console.info(...t)})},log(...t){return S(()=>{console.log(...t)})},table(t,e){return S(()=>{console.table(t,e)})},time(t){return S(()=>console.time(t))},timeEnd(t){return S(()=>console.timeEnd(t))},timeLog(t,...e){return S(()=>{console.timeLog(t,...e)})},trace(...t){return S(()=>{console.trace(...t)})},warn(...t){return S(()=>{console.warn(...t)})},unsafe:console},Z_="effect/Random",Bo=Symbol.for(Z_),tb=Fe("effect/Random");var dc;dc=Bo;class eb{constructor(e){a(this,"seed");a(this,dc,Bo);a(this,"PRNG");this.seed=e,this.PRNG=new Mf(e)}get next(){return S(()=>this.PRNG.number())}get nextBoolean(){return ct(this.next,e=>e>.5)}get nextInt(){return S(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,n){return ct(this.next,r=>(n-e)*r+e)}nextIntBetween(e,n){return S(()=>this.PRNG.integer(n-e)+e)}shuffle(e){return nb(e,n=>this.nextIntBetween(0,n))}}const nb=(t,e)=>H(()=>h(S(()=>Array.from(t)),O(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return h(r,Si(s=>h(e(s),ct(i=>rb(n,s-1,i)))),vn(Ca(n)))}))),rb=(t,e,n)=>{const r=t[e];return t[e]=t[n],t[n]=r,t},sb=t=>new eb(b(t)),Vo=Symbol.for("effect/Tracer"),ib=t=>({[Vo]:Vo,...t}),ul=Fe("effect/Tracer"),ll=Fe("effect/ParentSpan"),Ko=function(){const t="abcdef0123456789",e=t.length;return function(n){let r="";for(let s=0;s<n;s++)r+=t.charAt(Math.floor(Math.random()*e));return r}}();class ob{constructor(e,n,r,s,i,o){a(this,"name");a(this,"parent");a(this,"context");a(this,"startTime");a(this,"kind");a(this,"_tag","Span");a(this,"spanId");a(this,"traceId","native");a(this,"sampled",!0);a(this,"status");a(this,"attributes");a(this,"events",[]);a(this,"links");this.name=e,this.parent=n,this.context=r,this.startTime=i,this.kind=o,this.status={_tag:"Started",startTime:i},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:Ko(32),this.spanId=Ko(16),this.links=Array.from(s)}end(e,n){this.status={_tag:"Ended",endTime:e,exit:n,startTime:this.status.startTime}}attribute(e,n){this.attributes.set(e,n)}event(e,n,r){this.events.push([e,n,r??{}])}addLinks(e){this.links.push(...e)}}const cb=ib({span:(t,e,n,r,s,i)=>new ob(t,e,n,r,s,i),context:t=>t()}),ab=h(ei(),Be(qr,b_()),Be(al,X_),Be(tb,sb(Math.random())),Be(x_,U_()),Be(ul,cb)),lr=C(Symbol.for("effect/DefaultServices/currentServices"),()=>Hu(ab)),ub=t=>{const e=vt(t);return fb(n=>n.sleep(e))},lb=t=>lt(e=>t(e.currentDefaultServices)),fb=t=>lb(e=>t(e.unsafeMap.get(qr.key))),hb=ub;function db(t){return new jt(t)}function gb(){return db(new Map)}const Jo=Symbol.for("effect/FiberRefs");var gc;gc=Jo;class jt{constructor(e){a(this,"locals");a(this,gc,Jo);this.locals=e}pipe(){return y(this,arguments)}}const pb=(t,e,n,r=!1)=>{const s=t;let i=e,o=n,c=r,u;for(;u===void 0;)if(et(i)&&et(o)){const f=tt(i)[0],d=de(i),g=tt(o)[0],p=tt(o)[1],m=de(o);f.startTimeMillis<g.startTimeMillis?(o=m,c=!0):f.startTimeMillis>g.startTimeMillis?i=d:f.id<g.id?(o=m,c=!0):f.id>g.id?i=d:u=[p,c]}else u=[s.initial,!0];return u},mb=l(3,(t,e,n)=>{const r=new Map(t.locals);return n.locals.forEach((s,i)=>{const o=s[0][1];if(!s[0][0][v](e)){if(!r.has(i)){if(I(o,i.initial))return;r.set(i,[[e,i.join(i.initial,o)]]);return}const c=r.get(i),[u,f]=pb(i,c,s);if(f){const d=i.diff(u,o),g=c[0][1],p=i.join(g,i.patch(d)(g));if(!I(g,p)){let m;const _=c[0][0];_[v](e)?m=[[_,p],...c.slice(1)]:m=[[e,p],...c],r.set(i,m)}}}}),new jt(r)}),_b=l(2,(t,e)=>{const n=new Map;return fl(t,n,e),new jt(n)}),fl=(t,e,n)=>{t.locals.forEach((r,s)=>{const i=r[0][1],o=s.patch(s.fork)(i);I(i,o)?e.set(s,r):e.set(s,[[n,o],...r])})},hl=l(2,(t,e)=>{const n=new Map(t.locals);return n.delete(e),new jt(n)}),bb=l(2,(t,e)=>t.locals.has(e)?R(tt(t.locals.get(e))[1]):k()),un=l(2,(t,e)=>h(bb(t,e),Yt(()=>e.initial))),Rs=l(2,(t,{fiberId:e,fiberRef:n,value:r})=>{if(t.locals.size===0)return new jt(new Map([[n,[[e,r]]]]));const s=new Map(t.locals);return Cs(s,e,n,r),new jt(s)}),Cs=(t,e,n,r)=>{const s=t.get(n)??[];let i;if(et(s)){const[o,c]=tt(s);if(o[v](e)){if(I(c,r))return;i=[[e,r],...s.slice(1)]}else i=[[e,r],...s]}else i=[[e,r]];t.set(n,i)},yb=l(2,(t,{entries:e,forkAs:n})=>{if(t.locals.size===0)return new jt(new Map(e));const r=new Map(t.locals);return n!==void 0&&fl(t,r,n),e.forEach(([s,i])=>{i.length===1?Cs(r,i[0][0],s,i[0][1]):i.forEach(([o,c])=>{Cs(r,o,s,c)})}),new jt(r)}),Sb=un,kb=yb,vb=gb,Ib=Tm,wb=Nm,Ob=Am,Eb=Pm,$b=Vu,Mb=Ku,Rb=xm,Cb=jm,Fb=h(Ze,eh(t=>t.ordinal)),Tb=nh(Fb),Nb=t=>{switch(t){case"All":return Ib;case"Debug":return Mb;case"Error":return Ob;case"Fatal":return wb;case"Info":return $b;case"Trace":return Rb;case"None":return Cb;case"Warning":return Eb}},dl=t=>t.replace(/[\s="]/g,"_"),Ab=t=>e=>`${dl(e.label)}=${t-e.startTime}ms`,Pb=gn,xb=Kf;class jb extends xb{}const gl="Empty",pl="Add",ml="Remove",_l="Update",bl="AndThen",Lb={_tag:gl},Db=(t,e)=>{const n=new Map(t.locals);let r=Lb;for(const[s,i]of e.locals.entries()){const o=tt(i)[1],c=n.get(s);if(c!==void 0){const u=tt(c)[1];I(u,o)||(r=ns({_tag:_l,fiberRef:s,patch:s.diff(u,o)})(r))}else r=ns({_tag:pl,fiberRef:s,value:o})(r);n.delete(s)}for(const[s]of n.entries())r=ns({_tag:ml,fiberRef:s})(r);return r},ns=l(2,(t,e)=>({_tag:bl,first:t,second:e})),qb=l(3,(t,e,n)=>{let r=n,s=ft(t);for(;et(s);){const i=tt(s),o=de(s);switch(i._tag){case gl:{s=o;break}case pl:{r=Rs(r,{fiberId:e,fiberRef:i.fiberRef,value:i.value}),s=o;break}case ml:{r=hl(r,i.fiberRef),s=o;break}case _l:{const c=un(r,i.fiberRef);r=Rs(r,{fiberId:e,fiberRef:i.fiberRef,value:i.fiberRef.patch(i.patch)(c)}),s=o;break}case bl:{s=Zn(i.first)(Zn(i.second)(o));break}}}return r}),yl="effect/MetricLabel",Fs=Symbol.for(yl);var pc;class Ub{constructor(e,n){a(this,"key");a(this,"value");a(this,pc,Fs);a(this,"_hash");this.key=e,this.value=n,this._hash=x(yl+this.key+this.value)}[(pc=Fs,w)](){return this._hash}[v](e){return Vb(e)&&this.key===e.key&&this.value===e.value}pipe(){return y(this,arguments)}}const Bb=(t,e)=>new Ub(t,e),Vb=t=>E(t,Fs),Kb=hb,Jb="Sequential",Hb={_tag:Jb},Gb=Db,Wb=qb,Ur="effect/FiberStatus",ee=Symbol.for(Ur),fr="Done",Ho="Running",Go="Suspended",Yb=x(`${Ur}-${fr}`);var mc;class zb{constructor(){a(this,mc,ee);a(this,"_tag",fr)}[(mc=ee,w)](){return Yb}[v](e){return Ci(e)&&e._tag===fr}}var _c;class Qb{constructor(e){a(this,"runtimeFlags");a(this,_c,ee);a(this,"_tag",Ho);this.runtimeFlags=e}[(_c=ee,w)](){return h(b(Ur),$(b(this._tag)),$(b(this.runtimeFlags)),A(this))}[v](e){return Ci(e)&&e._tag===Ho&&this.runtimeFlags===e.runtimeFlags}}var bc;class Xb{constructor(e,n){a(this,"runtimeFlags");a(this,"blockingOn");a(this,bc,ee);a(this,"_tag",Go);this.runtimeFlags=e,this.blockingOn=n}[(bc=ee,w)](){return h(b(Ur),$(b(this._tag)),$(b(this.runtimeFlags)),$(b(this.blockingOn)),A(this))}[v](e){return Ci(e)&&e._tag===Go&&this.runtimeFlags===e.runtimeFlags&&I(this.blockingOn,e.blockingOn)}}const Zb=new zb,ty=t=>new Qb(t),ey=(t,e)=>new Xb(t,e),Ci=t=>E(t,ee),ny=t=>t._tag===fr,ry=Zb,Sl=ty,sy=ey,iy=ny,oy=Symbol.for("effect/Micro"),hr=Symbol.for("effect/Micro/MicroExit"),Wo=Symbol.for("effect/Micro/MicroCause"),cy={_E:B};var yc;class kl extends globalThis.Error{constructor(n,r,s){const i=`MicroCause.${n}`;let o,c,u;if(r instanceof globalThis.Error){o=`(${i}) ${r.name}`,c=r.message;const f=c.split(`
`).length;u=r.stack?`(${i}) ${r.stack.split(`
`).slice(0,f+3).join(`
`)}`:`${o}: ${c}`}else o=i,c=le(r,0),u=`${o}: ${c}`;s.length>0&&(u+=`
    ${s.join(`
    `)}`);super(c);a(this,"_tag");a(this,"traces");a(this,yc);this._tag=n,this.traces=s,this[Wo]=cy,this.name=o,this.stack=u}pipe(){return y(this,arguments)}toString(){return this.stack}[(yc=Wo,P)](){return this.stack}}class ay extends kl{constructor(n,r=[]){super("Die",n,r);a(this,"defect");this.defect=n}}const uy=(t,e=[])=>new ay(t,e);class ly extends kl{constructor(e=[]){super("Interrupt","interrupted",e)}}const fy=(t=[])=>new ly(t),hy=t=>t._tag==="Interrupt",Yo=Symbol.for("effect/Micro/MicroFiber"),dy={_A:B,_E:B};var Sc;Sc=Yo;class gy{constructor(e,n=!0){a(this,"context");a(this,"interruptible");a(this,Sc);a(this,"_stack",[]);a(this,"_observers",[]);a(this,"_exit");a(this,"_children");a(this,"currentOpCount",0);a(this,"_interrupted",!1);a(this,"_yielded");this.context=e,this.interruptible=n,this[Yo]=dy}getRef(e){return Hh(this.context,e)}addObserver(e){return this._exit?(e(this._exit),gf):(this._observers.push(e),()=>{const n=this._observers.indexOf(e);n>=0&&this._observers.splice(n,1)})}unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(Pi))}unsafePoll(){return this._exit}evaluate(e){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(e);if(n===jn)return;const r=zo.interruptChildren&&zo.interruptChildren(this);if(r!==void 0)return this.evaluate(gr(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(e){let n=!1,r=e;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(xi).shouldYield(this)){n=!0;const s=r;r=gr(yy,()=>s)}if(r=r[Ts](this),r===jn){const s=this._yielded;return hr in s?(this._yielded=void 0,s):jn}}}catch(s){return E(r,Ts)?Ns(s):Ns(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(e){for(;;){const n=this._stack.pop();if(!n)return;const r=n[dr]&&n[dr](this);if(r)return{[e]:r};if(n[e])return n}}yieldWith(e){return this._yielded=e,jn}children(){return this._children??(this._children=new Set)}}const zo=C("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),vl=Symbol.for("effect/Micro/identifier"),q=Symbol.for("effect/Micro/args"),Ts=Symbol.for("effect/Micro/evaluate"),Re=Symbol.for("effect/Micro/successCont"),ue=Symbol.for("effect/Micro/failureCont"),dr=Symbol.for("effect/Micro/ensureCont"),jn=Symbol.for("effect/Micro/Yield"),py={_A:B,_E:B,_R:B},my={...Pb,_op:"Micro",[oy]:py,pipe(){return y(this,arguments)},[Symbol.iterator](){return new Yc(new fn(this))},toJSON(){return{_id:"Micro",op:this[vl],...q in this?{args:this[q]}:void 0}},toString(){return K(this)},[P](){return K(this)}};function _y(t){return Ns("Micro.evaluate: Not implemented")}const Br=t=>({...my,[vl]:t.op,[Ts]:t.eval??_y,[Re]:t.contA,[ue]:t.contE,[dr]:t.ensure}),Fi=t=>{const e=Br(t);return function(){const n=Object.create(e);return n[q]=t.single===!1?arguments:arguments[0],n}},Il=t=>{const e={...Br(t),[hr]:hr,_tag:t.op,get[t.prop](){return this[q]},toJSON(){return{_id:"MicroExit",_tag:t.op,[t.prop]:this[q]}},[v](n){return vy(n)&&n._tag===t.op&&I(this[q],n[q])},[w](){return A(this,$(x(t.op))(b(this[q])))}};return function(n){const r=Object.create(e);return r[q]=n,r[Re]=void 0,r[ue]=void 0,r[dr]=void 0,r}},Ti=Il({op:"Success",prop:"value",eval(t){const e=t.getCont(Re);return e?e[Re](this[q],t):t.yieldWith(this)}}),wl=Il({op:"Failure",prop:"cause",eval(t){let e=t.getCont(ue);for(;hy(this[q])&&e&&t.interruptible;)e=t.getCont(ue);return e?e[ue](this[q],t):t.yieldWith(this)}}),by=Fi({op:"Yield",eval(t){let e=!1;return t.getRef(xi).scheduleTask(()=>{e||t.evaluate(Iy)},this[q]??0),t.yieldWith(()=>{e=!0})}}),yy=by(0),Sy=Ti(void 0),Ni=Fi({op:"WithMicroFiber",eval(t){return this[q](t)}}),gr=l(2,(t,e)=>{const n=Object.create(ky);return n[q]=t,n[Re]=e,n}),ky=Br({op:"OnSuccess",eval(t){return t._stack.push(this),this[q]}}),vy=t=>E(t,hr),Ol=Ti,Ai=wl,Pi=Ai(fy()),Ns=t=>Ai(uy(t)),Iy=Ol(void 0),wy="setImmediate"in globalThis?globalThis.setImmediate:t=>setTimeout(t,0);class El{constructor(){a(this,"tasks",[]);a(this,"running",!1);a(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(e,n){this.tasks.push(e),this.running||(this.running=!0,wy(this.afterScheduled))}runTasks(){const e=this.tasks;this.tasks=[];for(let n=0,r=e.length;n<r;n++)e[n]()}shouldYield(e){return e.currentOpCount>=e.getRef($y)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const Oy=l(2,(t,e)=>Ni(n=>{const r=n.context;return n.context=e(r),Cy(t,()=>(n.context=r,Sy))})),Ey=l(2,(t,e)=>Oy(t,Qh(e)));class $y extends Ea()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class xi extends Ea()("effect/Micro/currentScheduler",{defaultValue:()=>new El}){}const My=l(2,(t,e)=>{const n=Object.create(Ry);return n[q]=t,n[Re]=e.onSuccess,n[ue]=e.onFailure,n}),Ry=Br({op:"OnSuccessAndFailure",eval(t){return t._stack.push(this),this[q]}}),Cy=l(2,(t,e)=>Ty(n=>My(n(t),{onFailure:r=>gr(e(Ai(r)),()=>wl(r)),onSuccess:r=>gr(e(Ol(r)),()=>Ti(r))}))),$l=Fi({op:"SetInterruptible",ensure(t){if(t.interruptible=this[q],t._interrupted&&t.interruptible)return()=>Pi}}),Fy=t=>Ni(e=>e.interruptible?t:(e.interruptible=!0,e._stack.push($l(!1)),e._interrupted?Pi:t)),Ty=t=>Ni(e=>e.interruptible?(e.interruptible=!1,e._stack.push($l(!0)),t(Fy)):t(B)),Ny=(t,e)=>{const n=new gy(xi.context(new El));return n.evaluate(t),n};class Ay{constructor(){a(this,"buckets",[])}scheduleTask(e,n){const r=this.buckets.length;let s,i=0;for(;i<r&&this.buckets[i][0]<=n;i++)s=this.buckets[i];s&&s[0]===n?s[1].push(e):i===r?this.buckets.push([n,[e]]):this.buckets.splice(i,0,[n,[e]])}}class Py{constructor(e){a(this,"maxNextTickBeforeTimer");a(this,"running",!1);a(this,"tasks",new Ay);this.maxNextTickBeforeTimer=e}starveInternal(e){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let i=0;i<s.length;i++)s[i]();this.tasks.buckets.length===0?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(Jm)?e.getFiberRef($i):!1}scheduleTask(e,n){this.tasks.scheduleTask(e,n),this.running||(this.running=!0,this.starve())}}const xy=C(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new Py(2048)),Ml=C(Symbol.for("effect/FiberRef/currentScheduler"),()=>mt(xy)),Rl=C(Symbol.for("effect/FiberRef/currentRequestMap"),()=>mt(new Map)),ji="InterruptSignal",Li="Stateful",Di="Resume",qi="YieldNow",rs=t=>({_tag:ji,cause:t}),Hn=t=>({_tag:Li,onFiber:t}),se=t=>({_tag:Di,effect:t}),jy=()=>({_tag:qi}),Ly="effect/FiberScope",pr=Symbol.for(Ly);var kc;kc=pr;class Dy{constructor(){a(this,kc,pr);a(this,"fiberId",ke);a(this,"roots",new Set)}add(e,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}var vc;vc=pr;class qy{constructor(e,n){a(this,"fiberId");a(this,"parent");a(this,vc,pr);this.fiberId=e,this.parent=n}add(e,n){this.parent.tell(Hn(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const Uy=t=>new qy(t.id(),t),Ui=C(Symbol.for("effect/FiberScope/Global"),()=>new Dy),By="effect/Fiber",Vy=Symbol.for(By),Ky={_E:t=>t,_A:t=>t},Jy="effect/Fiber",Hy=Symbol.for(Jy),Cl=t=>qu(Au(t.await),t.inheritAll);({...pn});const Dt="effect/FiberCurrent",Gy="effect/Logger",Wy=Symbol.for(Gy),Yy={_Message:t=>t,_Output:t=>t},Bi=t=>({[Wy]:Yy,log:t,pipe(){return y(this,arguments)}}),zy=/^[^\s"=]*$/,Qy=(t,e)=>({annotations:n,cause:r,date:s,fiberId:i,logLevel:o,message:c,spans:u})=>{const f=_=>_.match(zy)?_:t(_),d=(_,M)=>`${dl(_)}=${f(M)}`,g=(_,M)=>" "+d(_,M);let p=d("timestamp",s.toISOString());p+=g("level",o.label),p+=g("fiber",Xa(i));const m=fh(c);for(let _=0;_<m.length;_++)p+=g("message",le(m[_],e));zp(r)||(p+=g("cause",Sn(r,{renderErrorCause:!0})));for(const _ of u)p+=" "+Ab(s.getTime())(_);for(const[_,M]of n)p+=g(_,le(M,e));return p},Xy=t=>`"${t.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,Zy=Bi(Qy(Xy)),tS=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null;tS&&process.stdout.isTTY;const Fl="effect/MetricBoundaries",As=Symbol.for(Fl);var Ic;class eS{constructor(e){a(this,"values");a(this,Ic,As);a(this,"_hash");this.values=e,this._hash=h(x(Fl),$(hn(this.values)))}[(Ic=As,w)](){return this._hash}[v](e){return nS(e)&&I(this.values,e.values)}pipe(){return y(this,arguments)}}const nS=t=>E(t,As),rS=t=>{const e=h(t,pa(nt(Number.POSITIVE_INFINITY)),Ch);return new eS(e)},sS=t=>h(lh(t.count-1,e=>t.start*Math.pow(t.factor,e)),Er,rS),iS="effect/MetricKeyType",Tl=Symbol.for(iS),Nl="effect/MetricKeyType/Counter",Ps=Symbol.for(Nl),oS="effect/MetricKeyType/Frequency",cS=Symbol.for(oS),aS="effect/MetricKeyType/Gauge",uS=Symbol.for(aS),Al="effect/MetricKeyType/Histogram",xs=Symbol.for(Al),lS="effect/MetricKeyType/Summary",fS=Symbol.for(lS),Pl={_In:t=>t,_Out:t=>t};var wc,Oc;class hS{constructor(e,n){a(this,"incremental");a(this,"bigint");a(this,Oc,Pl);a(this,wc,Ps);a(this,"_hash");this.incremental=e,this.bigint=n,this._hash=x(Nl)}[(Oc=Tl,wc=Ps,w)](){return this._hash}[v](e){return xl(e)}pipe(){return y(this,arguments)}}var Ec,$c;class dS{constructor(e){a(this,"boundaries");a(this,$c,Pl);a(this,Ec,xs);a(this,"_hash");this.boundaries=e,this._hash=h(x(Al),$(b(this.boundaries)))}[($c=Tl,Ec=xs,w)](){return this._hash}[v](e){return jl(e)&&I(this.boundaries,e.boundaries)}pipe(){return y(this,arguments)}}const gS=t=>new hS((t==null?void 0:t.incremental)??!1,(t==null?void 0:t.bigint)??!1),pS=t=>new dS(t),xl=t=>E(t,Ps),mS=t=>E(t,cS),_S=t=>E(t,uS),jl=t=>E(t,xs),bS=t=>E(t,fS),yS="effect/MetricKey",Ll=Symbol.for(yS),SS={_Type:t=>t},kS=Zs(I);var Mc;class Vi{constructor(e,n,r,s=[]){a(this,"name");a(this,"keyType");a(this,"description");a(this,"tags");a(this,Mc,SS);a(this,"_hash");this.name=e,this.keyType=n,this.description=r,this.tags=s,this._hash=h(x(this.name+this.description),$(b(this.keyType)),$(hn(this.tags)))}[(Mc=Ll,w)](){return this._hash}[v](e){return vS(e)&&this.name===e.name&&I(this.keyType,e.keyType)&&I(this.description,e.description)&&kS(this.tags,e.tags)}pipe(){return y(this,arguments)}}const vS=t=>E(t,Ll),IS=(t,e)=>new Vi(t,gS(e),Qs(e==null?void 0:e.description)),wS=(t,e,n)=>new Vi(t,pS(e),Qs(n)),OS=l(2,(t,e)=>e.length===0?t:new Vi(t.name,t.keyType,t.description,Un(t.tags,e))),ES="effect/MetricState",wn=Symbol.for(ES),Dl="effect/MetricState/Counter",js=Symbol.for(Dl),ql="effect/MetricState/Frequency",Ls=Symbol.for(ql),Ul="effect/MetricState/Gauge",Ds=Symbol.for(Ul),Bl="effect/MetricState/Histogram",qs=Symbol.for(Bl),Vl="effect/MetricState/Summary",Us=Symbol.for(Vl),On={_A:t=>t};var Rc,Cc;class $S{constructor(e){a(this,"count");a(this,Cc,On);a(this,Rc,js);this.count=e}[(Cc=wn,Rc=js,w)](){return h(b(Dl),$(b(this.count)),A(this))}[v](e){return LS(e)&&this.count===e.count}pipe(){return y(this,arguments)}}const MS=Zs(I);var Fc,Tc;class RS{constructor(e){a(this,"occurrences");a(this,Tc,On);a(this,Fc,Ls);a(this,"_hash");this.occurrences=e}[(Tc=wn,Fc=Ls,w)](){return h(x(ql),$(hn(V(this.occurrences.entries()))),A(this))}[v](e){return DS(e)&&MS(V(this.occurrences.entries()),V(e.occurrences.entries()))}pipe(){return y(this,arguments)}}var Nc,Ac;class CS{constructor(e){a(this,"value");a(this,Ac,On);a(this,Nc,Ds);this.value=e}[(Ac=wn,Nc=Ds,w)](){return h(b(Ul),$(b(this.value)),A(this))}[v](e){return qS(e)&&this.value===e.value}pipe(){return y(this,arguments)}}var Pc,xc;class FS{constructor(e,n,r,s,i){a(this,"buckets");a(this,"count");a(this,"min");a(this,"max");a(this,"sum");a(this,xc,On);a(this,Pc,qs);this.buckets=e,this.count=n,this.min=r,this.max=s,this.sum=i}[(xc=wn,Pc=qs,w)](){return h(b(Bl),$(b(this.buckets)),$(b(this.count)),$(b(this.min)),$(b(this.max)),$(b(this.sum)),A(this))}[v](e){return US(e)&&I(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return y(this,arguments)}}var jc,Lc;class TS{constructor(e,n,r,s,i,o){a(this,"error");a(this,"quantiles");a(this,"count");a(this,"min");a(this,"max");a(this,"sum");a(this,Lc,On);a(this,jc,Us);this.error=e,this.quantiles=n,this.count=r,this.min=s,this.max=i,this.sum=o}[(Lc=wn,jc=Us,w)](){return h(b(Vl),$(b(this.error)),$(b(this.quantiles)),$(b(this.count)),$(b(this.min)),$(b(this.max)),$(b(this.sum)),A(this))}[v](e){return BS(e)&&this.error===e.error&&I(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return y(this,arguments)}}const NS=t=>new $S(t),AS=t=>new RS(t),PS=t=>new CS(t),xS=t=>new FS(t.buckets,t.count,t.min,t.max,t.sum),jS=t=>new TS(t.error,t.quantiles,t.count,t.min,t.max,t.sum),LS=t=>E(t,js),DS=t=>E(t,Ls),qS=t=>E(t,Ds),US=t=>E(t,qs),BS=t=>E(t,Us),VS="effect/MetricHook",KS=Symbol.for(VS),JS={_In:t=>t,_Out:t=>t},En=t=>({[KS]:JS,pipe(){return y(this,arguments)},...t}),Qo=BigInt(0),HS=t=>{let e=t.keyType.bigint?Qo:0;const n=t.keyType.incremental?t.keyType.bigint?s=>s>=Qo:s=>s>=0:s=>!0,r=s=>{n(s)&&(e=e+s)};return En({get:()=>NS(e),update:r,modify:r})},GS=t=>{const e=new Map;for(const r of t.keyType.preregisteredWords)e.set(r,0);const n=r=>{const s=e.get(r)??0;e.set(r,s+1)};return En({get:()=>AS(e),update:n,modify:n})},WS=(t,e)=>{let n=e;return En({get:()=>PS(n),update:r=>{n=r},modify:r=>{n=n+r}})},YS=t=>{const e=t.keyType.boundaries.values,n=e.length,r=new Uint32Array(n+1),s=new Float32Array(n);let i=0,o=0,c=Number.MAX_VALUE,u=Number.MIN_VALUE;h(e,tr(Ze),oe((g,p)=>{s[p]=g}));const f=g=>{let p=0,m=n;for(;p!==m;){const _=Math.floor(p+(m-p)/2),M=s[_];g<=M?m=_:p=_,m===p+1&&(g<=s[p]?m=p:p=m)}r[p]=r[p]+1,i=i+1,o=o+g,g<c&&(c=g),g>u&&(u=g)},d=()=>{const g=Xs(n);let p=0;for(let m=0;m<n;m++){const _=s[m],M=r[m];p=p+M,g[m]=[_,p]}return g};return En({get:()=>xS({buckets:d(),count:i,min:c,max:u,sum:o}),update:f,modify:f})},zS=t=>{const{error:e,maxAge:n,maxSize:r,quantiles:s}=t.keyType,i=h(s,tr(Ze)),o=Xs(r);let c=0,u=0,f=0,d=Number.MAX_VALUE,g=Number.MIN_VALUE;const p=_=>{const M=[];let T=0;for(;T!==r-1;){const J=o[T];if(J!=null){const[j,_t]=J,Ot=ds(_-j);vd(Ot,Aa)&&Ot<=n&&M.push(_t)}T=T+1}return QS(e,i,tr(M,Ze))},m=(_,M)=>{if(r>0){c=c+1;const T=c%r;o[T]=[M,_]}u=u+1,f=f+_,_<d&&(d=_),_>g&&(g=_)};return En({get:()=>jS({error:e,quantiles:p(Date.now()),count:u,min:d,max:g,sum:f}),update:([_,M])=>m(_,M),modify:([_,M])=>m(_,M)})},QS=(t,e,n)=>{const r=n.length;if(!et(e))return ge();const s=e[0],i=e.slice(1),o=Xo(t,r,k(),0,s,n),c=ft(o);return i.forEach(u=>{c.push(Xo(t,r,o.value,o.consumed,u,o.rest))}),oe(c,u=>[u.quantile,u.value])},Xo=(t,e,n,r,s,i)=>{let o=t,c=e,u=n,f=r,d=s,g=i,p=t,m=e,_=n,M=r,T=s,J=i;for(;;){if(!et(g))return{quantile:d,value:k(),consumed:f,rest:[]};if(d===1)return{quantile:d,value:R(ba(g)),consumed:f+g.length,rest:[]};const j=Sh(g,ne=>ne<=g[0]),_t=d*c,Ot=o/2*_t,Et=f+j[0].length,$n=Math.abs(Et-_t);if(Et<_t-Ot){p=o,m=c,_=ze(g),M=Et,T=d,J=j[1],o=p,c=m,u=_,f=M,d=T,g=J;continue}if(Et>_t+Ot)return{quantile:d,value:u,consumed:f,rest:g};switch(u._tag){case"None":{p=o,m=c,_=ze(g),M=Et,T=d,J=j[1],o=p,c=m,u=_,f=M,d=T,g=J;continue}case"Some":{const ne=Math.abs(_t-u.value);if($n<ne){p=o,m=c,_=ze(g),M=Et,T=d,J=j[1],o=p,c=m,u=_,f=M,d=T,g=J;continue}return{quantile:d,value:R(u.value),consumed:f,rest:g}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},XS="effect/MetricPair",ZS=Symbol.for(XS),t0={_Type:t=>t},e0=(t,e)=>({[ZS]:t0,metricKey:t,metricState:e,pipe(){return y(this,arguments)}}),n0="effect/MetricRegistry",Zo=Symbol.for(n0);var Dc;Dc=Zo;class r0{constructor(){a(this,Dc,Zo);a(this,"map",f_())}snapshot(){const e=[];for(const[n,r]of this.map)e.push(e0(n,r.get()));return e}get(e){const n=h(this.map,Ut(e),qt);if(n==null){if(xl(e.keyType))return this.getCounter(e);if(_S(e.keyType))return this.getGauge(e);if(mS(e.keyType))return this.getFrequency(e);if(jl(e.keyType))return this.getHistogram(e);if(bS(e.keyType))return this.getSummary(e);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(e){let n=h(this.map,Ut(e),qt);if(n==null){const r=HS(e);h(this.map,Ve(e))||h(this.map,Ke(e,r)),n=r}return n}getFrequency(e){let n=h(this.map,Ut(e),qt);if(n==null){const r=GS(e);h(this.map,Ve(e))||h(this.map,Ke(e,r)),n=r}return n}getGauge(e){let n=h(this.map,Ut(e),qt);if(n==null){const r=WS(e,e.keyType.bigint?BigInt(0):0);h(this.map,Ve(e))||h(this.map,Ke(e,r)),n=r}return n}getHistogram(e){let n=h(this.map,Ut(e),qt);if(n==null){const r=YS(e);h(this.map,Ve(e))||h(this.map,Ke(e,r)),n=r}return n}getSummary(e){let n=h(this.map,Ut(e),qt);if(n==null){const r=zS(e);h(this.map,Ve(e))||h(this.map,Ke(e,r)),n=r}return n}}const s0=()=>new r0,i0="effect/Metric",o0=Symbol.for(i0),c0={_Type:t=>t,_In:t=>t,_Out:t=>t},tc=C(Symbol.for("effect/Metric/globalMetricRegistry"),()=>s0()),Kl=function(t,e,n,r){const s=Object.assign(i=>Em(i,o=>f0(s,o)),{[o0]:c0,keyType:t,unsafeUpdate:e,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return y(this,arguments)}});return s},Vr=(t,e)=>Jl(IS(t,e)),Jl=t=>{let e;const n=new WeakMap,r=s=>{if(s.length===0)return e!==void 0||(e=tc.get(t)),e;let i=n.get(s);return i!==void 0||(i=tc.get(OS(t,s)),n.set(s,i)),i};return Kl(t.keyType,(s,i)=>r(i).update(s),s=>r(s).get(),(s,i)=>r(i).modify(s))},a0=(t,e,n)=>Jl(wS(t,e,n)),u0=l(3,(t,e,n)=>l0(t,[Bb(e,n)])),l0=l(2,(t,e)=>Kl(t.keyType,(n,r)=>t.unsafeUpdate(n,Un(e,r)),n=>t.unsafeValue(Un(e,n)),(n,r)=>t.unsafeModify(n,Un(e,r)))),f0=l(2,(t,e)=>Ju($s,n=>S(()=>t.unsafeUpdate(e,n))));({...Ys});const h0=l(2,(t,e)=>Ju(Rl,n=>S(()=>{if(n.has(t)){const r=n.get(t);r.state.completed||(r.state.completed=!0,Xu(r.result,e))}}))),d0="effect/Supervisor",Kr=Symbol.for(d0),Ki={_T:t=>t};var qc;qc=Kr;const Hi=class Hi{constructor(e,n){a(this,"underlying");a(this,"value0");a(this,qc,Ki);this.underlying=e,this.value0=n}get value(){return this.value0}onStart(e,n,r,s){this.underlying.onStart(e,n,r,s)}onEnd(e,n){this.underlying.onEnd(e,n)}onEffect(e,n){this.underlying.onEffect(e,n)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new Hi(this,h(this.value,ct(e)))}zip(e){return new _r(this,e)}};let mr=Hi;var Uc;Uc=Kr;const Gi=class Gi{constructor(e,n){a(this,"left");a(this,"right");a(this,"_tag","Zip");a(this,Uc,Ki);this.left=e,this.right=n}get value(){return Du(this.left.value,this.right.value)}onStart(e,n,r,s){this.left.onStart(e,n,r,s),this.right.onStart(e,n,r,s)}onEnd(e,n){this.left.onEnd(e,n),this.right.onEnd(e,n)}onEffect(e,n){this.left.onEffect(e,n),this.right.onEffect(e,n)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new mr(this,h(this.value,ct(e)))}zip(e){return new Gi(this,e)}};let _r=Gi;const Hl=t=>E(t,Kr)&&Wc(t,"Zip");var Bc;Bc=Kr;class g0{constructor(e){a(this,"effect");a(this,Bc,Ki);this.effect=e}get value(){return this.effect}onStart(e,n,r,s){}onEnd(e,n){}onEffect(e,n){}onSuspend(e){}onResume(e){}map(e){return new mr(this,h(this.value,ct(e)))}zip(e){return new _r(this,e)}onRun(e,n){return e()}}const p0=t=>new g0(t),Jr=C("effect/Supervisor/none",()=>p0(It)),m0=Te,Gl="Empty",Wl="AddSupervisor",Yl="RemoveSupervisor",zl="AndThen",Xe={_tag:Gl},Gn=(t,e)=>({_tag:zl,first:t,second:e}),_0=(t,e)=>b0(e,nt(t)),b0=(t,e)=>{let n=t,r=e;for(;_e(r);){const s=be(r);switch(s._tag){case Gl:{r=Bt(r);break}case Wl:{n=n.zip(s.supervisor),r=Bt(r);break}case Yl:{n=Bs(n,s.supervisor),r=Bt(r);break}case zl:{r=gt(s.first)(gt(s.second)(Bt(r)));break}}}return n},Bs=(t,e)=>I(t,e)?Jr:Hl(t)?Bs(t.left,e).zip(Bs(t.right,e)):t,br=t=>I(t,Jr)?Qt():Hl(t)?h(br(t.left),nn(br(t.right))):li(t),y0=(t,e)=>{if(I(t,e))return Xe;const n=br(t),r=br(e),s=h(r,fo(n),rr(Xe,(o,c)=>Gn(o,{_tag:Wl,supervisor:c}))),i=h(n,fo(r),rr(Xe,(o,c)=>Gn(o,{_tag:Yl,supervisor:c})));return Gn(s,i)},S0=m0({empty:Xe,patch:_0,combine:Gn,diff:y0}),k0=Vr("effect_fiber_started",{incremental:!0}),ec=Vr("effect_fiber_active"),v0=Vr("effect_fiber_successes",{incremental:!0}),I0=Vr("effect_fiber_failures",{incremental:!0}),w0=u0(a0("effect_fiber_lifetimes",sS({start:.5,factor:2,count:35})),"time_unit","milliseconds"),Je="Continue",O0="Done",nc="Yield",E0={_E:t=>t,_A:t=>t},Ln=t=>{throw new Error(`BUG: FiberRuntime - ${le(t)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},Mt=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),Rt=C("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),He={[zn]:(t,e,n)=>z(()=>e.effect_instruction_i1(n)),OnStep:(t,e,n)=>D(D(n)),[Qn]:(t,e,n)=>z(()=>e.effect_instruction_i2(n)),[Ws]:(t,e,n)=>(t.patchRuntimeFlags(t.currentRuntimeFlags,e.patch),At(t.currentRuntimeFlags)&&t.isInterrupted()?F(t.getInterruptedCause()):D(n)),[Xn]:(t,e,n)=>(z(()=>e.effect_instruction_i2(n)),z(()=>e.effect_instruction_i0())?(t.pushStack(e),z(()=>e.effect_instruction_i1())):It),[Ye]:(t,e,n)=>{const r=z(()=>e.effect_instruction_i0.next(n));return r.done?D(r.value):(t.pushStack(e),Cf(r.value))}},$0={[ji]:(t,e,n,r)=>(t.processNewInterruptSignal(r.cause),At(e)?F(r.cause):n),[Di]:(t,e,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[Li]:(t,e,n,r)=>(r.onFiber(t,Sl(e)),n),[qi]:(t,e,n,r)=>O(wi(),()=>n)},M0=t=>Si(Np(t),e=>Xl(Gp(e),([n,r])=>{const s=new Map,i=[];for(const c of r){i.push(Gt(c));for(const u of c)s.set(u.request,u)}const o=i.flat();return Ei(q0(n.runAll(i),o,()=>o.forEach(c=>{c.listeners.interrupted=!0})),Rl,s)},!1,!1)),R0=Sr();var Vc,Kc;class Ql extends jb{constructor(n,r,s){super();a(this,Kc,Ky);a(this,Vc,E0);a(this,"_fiberRefs");a(this,"_fiberId");a(this,"_queue",new Array);a(this,"_children",null);a(this,"_observers",new Array);a(this,"_running",!1);a(this,"_stack",[]);a(this,"_asyncInterruptor",null);a(this,"_asyncBlockingOn",null);a(this,"_exitValue",null);a(this,"_steps",[]);a(this,"_isYielding",!1);a(this,"currentRuntimeFlags");a(this,"currentOpCount",0);a(this,"currentSupervisor");a(this,"currentScheduler");a(this,"currentTracer");a(this,"currentSpan");a(this,"currentContext");a(this,"currentDefaultServices");a(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this.currentRuntimeFlags=s,this._fiberId=n,this._fiberRefs=r,_o(s)){const i=this.getFiberRef($s);k0.unsafeUpdate(1,i),ec.unsafeUpdate(1,i)}this.refreshRefCache()}commit(){return Cl(this)}id(){return this._fiberId}resume(n){this.tell(se(n))}get status(){return this.ask((n,r)=>r)}get runtimeFlags(){return this.ask((n,r)=>iy(r)?n.currentRuntimeFlags:r.runtimeFlags)}scope(){return Uy(this)}get children(){return this.ask(n=>Array.from(n.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(xn)}fiberRefs(){return this.ask(n=>n.getFiberRefs())}ask(n){return H(()=>{const r=c_(this._fiberId);return this.tell(Hn((s,i)=>{Xu(r,S(()=>n(s,i)))})),Qu(r)})}tell(n){this._queue.push(n),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return an(n=>{const r=s=>n(N(s));return this.tell(Hn((s,i)=>{s._exitValue!==null?r(this._exitValue):s.addObserver(r)})),S(()=>this.tell(Hn((s,i)=>{s.removeObserver(r)})))},this.id())}get inheritAll(){return lt((n,r)=>{const s=n.id(),i=n.getFiberRefs(),o=r.runtimeFlags,c=this.getFiberRefs(),u=mb(i,s,c);n.setFiberRefs(u);const f=n.getFiberRef(rc),d=h(Kn(o,f),yo(Ne),yo(ws));return Mm(d)})}get poll(){return S(()=>Qs(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(n){return S(()=>this.tell(rs(Pt(n))))}unsafeInterruptAsFork(n){this.tell(rs(Pt(n)))}addObserver(n){this._exitValue!==null?n(this._exitValue):this._observers.push(n)}removeObserver(n){this._observers=this._observers.filter(r=>r!==n)}getFiberRefs(){return this.setFiberRef(rc,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(n){this._fiberRefs=hl(this._fiberRefs,n)}getFiberRef(n){return this._fiberRefs.locals.has(n)?this._fiberRefs.locals.get(n)[0][1]:n.initial}setFiberRef(n,r){this._fiberRefs=Rs(this._fiberRefs,{fiberId:this._fiberId,fiberRef:n,value:r}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(lr),this.currentTracer=this.currentDefaultServices.unsafeMap.get(ul.key),this.currentSupervisor=this.getFiberRef(D0),this.currentScheduler=this.getFiberRef(Ml),this.currentContext=this.getFiberRef(Dr),this.currentSpan=this.currentContext.unsafeMap.get(ll.key)}setFiberRefs(n){this._fiberRefs=n,this.refreshRefCache()}addChild(n){this.getChildren().add(n)}removeChild(n){this.getChildren().delete(n)}transferChildren(n){const r=this._children;if(this._children=null,r!==null&&r.size>0)for(const s of r)s._exitValue===null&&n.add(this.currentRuntimeFlags,s)}drainQueueOnCurrentThread(){let n=!0;for(;n;){let r=Je;const s=globalThis[Dt];globalThis[Dt]=this;try{for(;r===Je;)r=this._queue.length===0?O0:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[Dt]=s}this._queue.length>0&&!this._running?(this._running=!0,r===nc?(this.drainQueueLaterOnExecutor(),n=!1):n=!0):n=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef($i))}drainQueueWhileRunning(n,r){let s=r;for(;this._queue.length>0;){const i=this._queue.splice(0,1)[0];s=$0[i._tag](this,n,s,i)}return s}isInterrupted(){return!Qp(this.getFiberRef(xn))}addInterruptedCause(n){const r=this.getFiberRef(xn);this.setFiberRef(xn,ot(r,n))}processNewInterruptSignal(n){this.addInterruptedCause(n),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let n=!1;for(const r of this._children)r.tell(rs(Pt(this.id()))),n=!0;return n}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const n=this._children.values();this._children=null;let r=!1;return Ii({while:()=>!r,body:()=>{const i=n.next();return i.done?S(()=>{r=!0}):In(i.value.await)},step:()=>{}})}return null}reportExitValue(n){if(_o(this.currentRuntimeFlags)){const r=this.getFiberRef($s),s=this.id().startTimeMillis,i=Date.now();switch(w0.unsafeUpdate(i-s,r),ec.unsafeUpdate(-1,r),n._tag){case ut:{v0.unsafeUpdate(1,r);break}case at:{I0.unsafeUpdate(1,r);break}}}if(n._tag==="Failure"){const r=this.getFiberRef(zm);!mi(n.cause)&&r._tag==="Some"&&this.log("Fiber terminated with an unhandled error",n.cause,r)}}setExitValue(n){this._exitValue=n,this.reportExitValue(n);for(let r=this._observers.length-1;r>=0;r--)this._observers[r](n);this._observers=[]}getLoggers(){return this.getFiberRef(A0)}log(n,r,s){const i=kt(s)?s.value:this.getFiberRef(Gm),o=this.getFiberRef(C0);if(Tb(o,i))return;const c=this.getFiberRef(Wm),u=this.getFiberRef(Hm),f=this.getLoggers(),d=this.getFiberRefs();if(Ga(f)>0){const g=wa(this.getFiberRef(lr),qr),p=new Date(g.unsafeCurrentTimeMillis());Af(d,()=>{for(const m of f)m.log({fiberId:this.id(),logLevel:i,message:n,cause:r,context:d,spans:c,annotations:u,date:p})})}}evaluateMessageWhileSuspended(n){switch(n._tag){case qi:return nc;case ji:return this.processNewInterruptSignal(n.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(F(n.cause)),this._asyncInterruptor=null),Je;case Di:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(n.effect),Je;case Li:return n.onFiber(this,this._exitValue!==null?ry:sy(this.currentRuntimeFlags,this._asyncBlockingOn)),Je;default:return Ln(n)}}evaluateEffect(n){this.currentSupervisor.onResume(this);try{let r=At(this.currentRuntimeFlags)&&this.isInterrupted()?F(this.getInterruptedCause()):n;for(;r!==null;){const s=r,i=this.runLoop(s);if(i===Mt){const o=Rt.currentOp;Rt.currentOp=null,o._op===qn?Mp(this.currentRuntimeFlags)?(this.tell(jy()),this.tell(se(Kt)),r=null):r=Kt:o._op===We&&(r=null)}else{this.currentRuntimeFlags=h(this.currentRuntimeFlags,Rp(ws));const o=this.interruptAllChildren();o!==null?r=O(o,()=>i):(this._queue.length===0?this.setExitValue(i):this.tell(se(i)),r=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(n){if(this._running)this.tell(se(n));else{this._running=!0;const r=globalThis[Dt];globalThis[Dt]=this;try{this.evaluateEffect(n)}finally{this._running=!1,globalThis[Dt]=r,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(n){this.tell(se(n))}patchRuntimeFlags(n,r){const s=Jn(n,r);return globalThis[Dt]=this,this.currentRuntimeFlags=s,s}initiateAsync(n,r){let s=!1;const i=o=>{s||(s=!0,this.tell(se(o)))};At(n)&&(this._asyncInterruptor=i);try{r(i)}catch(o){i(pt(Tt(o)))}}pushStack(n){this._stack.push(n),n._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const n=this._stack.pop();if(n)return n._op==="OnStep"&&this._steps.pop(),n}getNextSuccessCont(){let n=this.popStack();for(;n;){if(n._op!==Wr)return n;n=this.popStack()}}getNextFailCont(){let n=this.popStack();for(;n;){if(n._op!==zn&&n._op!==Xn&&n._op!==Ye)return n;n=this.popStack()}}[(Kc=Vy,Vc=Hy,xf)](n){return S(()=>Oa(this.currentContext,n))}Left(n){return Q(n.left)}None(n){return Q(new Yu)}Right(n){return D(n.right)}Some(n){return D(n.value)}Micro(n){return ar(r=>{let s=r;const i=Ny(Ey(n,this.currentContext));return i.addObserver(o=>{if(o._tag==="Success")return s(D(o.value));switch(o.cause._tag){case"Interrupt":return s(F(Pt(ke)));case"Fail":return s(Q(o.cause.error));case"Die":return s(Oo(o.cause.defect))}}),ar(o=>{s=c=>{o(It)},i.unsafeInterrupt()})})}[ta](n){const r=z(()=>n.effect_instruction_i0()),s=this.getNextSuccessCont();return s!==void 0?(s._op in He||Ln(s),He[s._op](this,s,r)):(Rt.currentOp=D(r),Mt)}[ut](n){const r=n,s=this.getNextSuccessCont();return s!==void 0?(s._op in He||Ln(s),He[s._op](this,s,r.effect_instruction_i0)):(Rt.currentOp=r,Mt)}[at](n){const r=n.effect_instruction_i0,s=this.getNextFailCont();if(s!==void 0)switch(s._op){case Wr:case Qn:return At(this.currentRuntimeFlags)&&this.isInterrupted()?F(So(r)):z(()=>s.effect_instruction_i1(r));case"OnStep":return At(this.currentRuntimeFlags)&&this.isInterrupted()?F(So(r)):D(F(r));case Ws:return this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),At(this.currentRuntimeFlags)&&this.isInterrupted()?F(ot(r,this.getInterruptedCause())):F(r);default:Ln(s)}else return Rt.currentOp=F(r),Mt}[ea](n){return z(()=>n.effect_instruction_i0(this,Sl(this.currentRuntimeFlags)))}Blocked(n){const r=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){const i=[],o=this._steps[this._steps.length-1];let c=this.popStack();for(;c&&c._op!=="OnStep";)i.push(c),c=this.popStack();this.setFiberRefs(o.refs),this.currentRuntimeFlags=o.flags;const u=Gb(o.refs,r),f=Kn(o.flags,s);return D(Eu(n.effect_instruction_i0,lt(d=>{for(;i.length>0;)d.pushStack(i.pop());return d.setFiberRefs(Wb(d.id(),d.getFiberRefs())(u)),d.currentRuntimeFlags=Jn(f)(d.currentRuntimeFlags),n.effect_instruction_i1})))}return Lr(i=>O(Zl(ym(n.effect_instruction_i0)),()=>i(n.effect_instruction_i1)))}RunBlocked(n){return M0(n.effect_instruction_i0)}[dn](n){const r=n.effect_instruction_i0,s=this.currentRuntimeFlags,i=Jn(s,r);if(At(i)&&this.isInterrupted())return F(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,r),n.effect_instruction_i1){const o=Kn(i,s);return this.pushStack(new Sm(o,n)),z(()=>n.effect_instruction_i1(s))}else return Kt}[zn](n){return this.pushStack(n),n.effect_instruction_i0}OnStep(n){return this.pushStack(n),n.effect_instruction_i0}[Wr](n){return this.pushStack(n),n.effect_instruction_i0}[Qn](n){return this.pushStack(n),n.effect_instruction_i0}[We](n){return this._asyncBlockingOn=n.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,n.effect_instruction_i0),Rt.currentOp=n,Mt}[qn](n){return this._isYielding=!1,Rt.currentOp=n,Mt}[Xn](n){const r=n.effect_instruction_i0,s=n.effect_instruction_i1;return r()?(this.pushStack(n),s()):Kt}[Ye](n){return He[Ye](this,n,void 0)}[Or](n){return z(()=>n.commit())}runLoop(n){let r=n;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&$p)!==0&&this.currentSupervisor.onEffect(this,r),this._queue.length>0&&(r=this.drainQueueWhileRunning(this.currentRuntimeFlags,r)),!this._isYielding){this.currentOpCount+=1;const s=this.currentScheduler.shouldYield(this);if(s!==!1){this._isYielding=!0,this.currentOpCount=0;const i=r;r=O(wi({priority:s}),()=>i)}}try{if(r=this.currentTracer.context(()=>R0!==r[$e]._V?Eo(`Cannot execute an Effect versioned ${r[$e]._V} with a Runtime of version ${Sr()}`):this[r._op](r),this),r===Mt){const s=Rt.currentOp;return s._op===qn||s._op===We?Mt:(Rt.currentOp=null,s._op===ut||s._op===at?s:F(Tt(s)))}}catch(s){r!==Mt&&!E(r,"_op")||!(r._op in this)?r=Eo(`Not a valid effect: ${le(r)}`):n_(s)?r=F(ot(Tt(s),Pt(ke))):r=Oo(s)}}}}const C0=C("effect/FiberRef/currentMinimumLogLevel",()=>mt(Nb("Info"))),F0=t=>Bi(e=>{const n=Sb(e.context,lr);wa(n,al).unsafe.log(t.log(e))}),T0=C(Symbol.for("effect/Logger/defaultLogger"),()=>F0(Zy)),N0=C(Symbol.for("effect/Logger/tracerLogger"),()=>Bi(({annotations:t,cause:e,context:n,fiberId:r,logLevel:s,message:i})=>{const o=zh(un(n,Dr),ll);if(o._tag==="None"||o.value._tag==="ExternalSpan")return;const c=Oa(un(n,lr),qr),u={};for(const[f,d]of t)u[f]=d;u["effect.fiberId"]=gg(r),u["effect.logLevel"]=s.label,e!==null&&e._tag!=="Empty"&&(u["effect.cause"]=Sn(e,{renderErrorCause:!0})),o.value.event(le(Array.isArray(i)?i[0]:i),c.unsafeCurrentTimeNanos(),u)})),A0=C(Symbol.for("effect/FiberRef/currentLoggers"),()=>Bm(li(T0,N0))),Xl=(t,e,n,r,s)=>Lr(i=>$m(o=>lt(c=>{let u=Array.from(t).reverse(),f=u.length;if(f===0)return It;let d=0,g=!1;const p=u.length,m=new Set,_=new Array,M=()=>m.forEach(Y=>{Y.currentScheduler.scheduleTask(()=>{Y.unsafeInterruptAsFork(c.id())},0)}),T=new Array,J=new Array,j=new Array,_t=()=>{const Y=_.filter(({exit:Z})=>Z._tag==="Failure").sort((Z,bt)=>Z.index<bt.index?-1:Z.index===bt.index?0:1).map(({exit:Z})=>Z);return Y.length===0&&Y.push(Kt),Y},Ot=(Y,Z=!1)=>{const bt=Lu(o(Y)),W=x0(bt,c,c.currentRuntimeFlags,Ui);return c.currentScheduler.scheduleTask(()=>{Z&&W.unsafeInterruptAsFork(c.id()),W.resume(bt)},0),W},Et=()=>{r||(f-=u.length,u=[]),g=!0,M()},$n=Fu,ne=Ot(an(Y=>{const Z=(W,$t)=>{W._op==="Blocked"?j.push(W):(_.push({index:$t,exit:W}),W._op==="Failure"&&!g&&Et())},bt=()=>{if(u.length>0){const W=u.pop();let $t=d++;const Mn=()=>{const rt=u.pop();return $t=d++,O(wi(),()=>O($n(i(e(rt,$t))),Lt))},Lt=rt=>u.length>0&&(Z(rt,$t),u.length>0)?Mn():N(rt),Rn=O($n(i(e(W,$t))),Lt),yt=Ot(Rn);T.push(yt),m.add(yt),g&&yt.currentScheduler.scheduleTask(()=>{yt.unsafeInterruptAsFork(c.id())},0),yt.addObserver(rt=>{let De;if(rt._op==="Failure"?De=rt:De=rt.effect_instruction_i0,J.push(yt),m.delete(yt),Z(De,$t),_.length===f)Y(N(Yt(Fo(_t(),{parallel:!0}),()=>Kt)));else if(j.length+_.length===f){const Wi=_t(),ef=j.map(qe=>qe.effect_instruction_i0).reduce(mu);Y(N(Eu(ef,Xl([Yt(Fo(Wi,{parallel:!0}),()=>Kt),...j.map(qe=>qe.effect_instruction_i1)],qe=>qe,n,!0))))}else bt()})}};for(let W=0;W<p;W++)bt()}));return In(vi(Au(i(Cl(ne))),zu({onFailure:Y=>{Et();const Z=j.length+1,bt=Math.min(j.length,j.length),W=Array.from(j);return an($t=>{let Mn=0,Lt=0;const Rn=(rt,De)=>Wi=>{Mn++,Mn===Z&&$t(D(F(Y))),W.length>0&&De&&yt()},yt=()=>{Ot(W.pop(),!0).addObserver(Rn(Lt,!0)),Lt++};ne.addObserver(Rn(Lt,!1)),Lt++;for(let rt=0;rt<bt;rt++)yt()})},onSuccess:()=>Vt(J,Y=>Y.inheritAll)})))}))),Zl=t=>j0(t,Ui),P0=(t,e,n,r=null)=>{const s=tf(t,e,n,r);return s.resume(t),s},x0=(t,e,n,r=null)=>tf(t,e,n,r),tf=(t,e,n,r=null)=>{const s=Za(),i=e.getFiberRefs(),o=_b(i,s),c=new Ql(s,o,n),u=un(o,Dr),f=c.currentSupervisor;return f.onStart(u,t,R(e),c),c.addObserver(g=>f.onEnd(g,c)),(r!==null?r:h(e.getFiberRef(Ms),Yt(()=>e.scope()))).add(n,c),c},j0=(t,e)=>lt((n,r)=>N(P0(t,n,r.runtimeFlags,e))),L0=t=>je(t,{differ:S0,fork:Xe}),rc=Km(Cp),D0=L0(Jr),q0=(t,e,n)=>Nu(r=>O(O(Zl(Pu(t)),s=>an(i=>{const o=e.map(f=>f.listeners.count),c=()=>{o.every(f=>f===0)&&e.every(f=>f.result.state.current._tag==="Pending"?!0:!!(f.result.state.current._tag==="Done"&&Mi(f.result.state.current.effect)&&f.result.state.current.effect._tag==="Failure"&&Xp(f.result.state.current.effect.cause)))&&(u.forEach(f=>f()),n==null||n(),i(Fm(s)))};s.addObserver(f=>{u.forEach(d=>d()),i(f)});const u=e.map((f,d)=>{const g=p=>{o[d]=p,c()};return f.listeners.addObserver(g),()=>f.listeners.removeObserver(g)});return c(),S(()=>{u.forEach(f=>f())})})),()=>H(()=>{const s=e.flatMap(i=>i.state.completed?[]:[i]);return Si(s,i=>h0(i.request,s_(r)))}))),U0=Xm,B0=Zm,Ji=t=>function(){if(arguments.length===1){const e=arguments[0];return(n,...r)=>t(e,n,...r)}return t.apply(this,arguments)},V0=Ji((t,e,n)=>{const r=Za(),s=[[Dr,[[r,t.context]]]];n!=null&&n.scheduler&&s.push([Ml,[[r,n.scheduler]]]);let i=kb(t.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(i=n.updateRefs(i,r));const o=new Ql(r,i,t.runtimeFlags);let c=e;n!=null&&n.scope&&(c=O(B0(n.scope,Hb),f=>Uu(Qm(f,Nu(d=>I(d,o.id())?It:Bu(o,d))),vi(e,d=>U0(f,d)))));const u=o.currentSupervisor;return u!==Jr&&(u.onStart(t.context,c,k(),o),o.addObserver(f=>u.onEnd(f,o))),Ui.add(t.runtimeFlags,o),(n==null?void 0:n.immediate)===!1?o.resume(c):o.start(c),o}),ss=Symbol.for("effect/Runtime/FiberFailure"),Dn=Symbol.for("effect/Runtime/FiberFailure/Cause");var Jc,Hc;class K0 extends Error{constructor(n){const r=wu(n)[0];super((r==null?void 0:r.message)||"An error has occurred");a(this,Hc);a(this,Jc);this[ss]=ss,this[Dn]=n,this.name=r?`(FiberFailure) ${r.name}`:"FiberFailure",r!=null&&r.stack&&(this.stack=r.stack)}toJSON(){return{_id:"FiberFailure",cause:this[Dn].toJSON()}}toString(){return"(FiberFailure) "+Sn(this[Dn],{renderErrorCause:!0})}[(Hc=ss,Jc=Dn,P)](){return this.toString()}}const J0=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new K0(t);return Error.stackTraceLimit=e,n},H0=t=>{const e=t;switch(e._op){case"Failure":case"Success":return e;case"Left":return To(e.left);case"Right":return D(e.right);case"Some":return D(e.value);case"None":return To(Yu())}},G0=Ji((t,e,n)=>W0(t,e,n).then(r=>{switch(r._tag){case ut:return r.effect_instruction_i0;case at:throw J0(r.effect_instruction_i0)}})),W0=Ji((t,e,n)=>new Promise(r=>{const s=H0(e);s&&r(s);const i=V0(t)(e);i.addObserver(o=>{r(o)}),(n==null?void 0:n.signal)!==void 0&&(n.signal.aborted?i.unsafeInterruptAsFork(i.id()):n.signal.addEventListener("abort",()=>{i.unsafeInterruptAsFork(i.id())},{once:!0}))}));class Y0{constructor(e,n,r){a(this,"context");a(this,"runtimeFlags");a(this,"fiberRefs");this.context=e,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return y(this,arguments)}}const z0=t=>new Y0(t.context,t.runtimeFlags,t.fiberRefs),Q0=gu(Ne,hu,fu),X0=z0({context:ei(),runtimeFlags:Q0,fiberRefs:vb()}),Z0=G0(X0),tk=Cm,ek=N,nk=Kb,sc=Z0;var rk=sf('<div class="m-8 p-4 border border-gray-300 rounded-md shadow-sm"><h2 class="text-xl font-semibold mb-2">Effect Result:</h2> <p class="font-bold text-blue-600"> </p> <div class="mt-4"><h3 class="text-lg font-medium mb-2"> </h3> <button class="bg-blue-600 hover:bg-blue-800 text-white py-2 px-4 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Increment with Effect</button></div></div>');function uk(t,e){cf(e,!0);let n=af({result:"Loading...",count:0});const r=ek("Hello from Effect!"),s=tk(function*(){return yield*nk("100 millis"),n.count+1});uf(()=>{sc(r).then(m=>{n.result=m})});function i(){sc(s).then(m=>{n.count=m})}var o=rk(),c=Hr(Cn(o),2),u=Cn(c,!0);Fn(c);var f=Hr(c,2),d=Cn(f),g=Cn(d);Fn(d);var p=Hr(d,2);Fn(f),Fn(o),lf(()=>{to(u,n.result),to(g,`Effect Counter: ${n.count??""}`)}),hf("click",p,i),of(t,o),ff()}export{uk as component};
